!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("@wonderlandlabs/propper")):"function"==typeof define&&define.amd?define(["@wonderlandlabs/propper"],r):(t=t||self).LGE=r(t.propper)}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(t,e)};function e(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t){return"function"==typeof t}var s=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;s=t},get useDeprecatedSynchronousErrorHandling(){return s}};function o(t){setTimeout((function(){throw t}),0)}var a={closed:!0,next:function(t){},error:function(t){if(i.useDeprecatedSynchronousErrorHandling)throw t;o(t)},complete:function(){}},u=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function c(t){return null!==t&&"object"==typeof t}var h=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,r){return r+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),l=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var r;if(!this.closed){var e=this._parentOrParents,s=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof t)e.remove(this);else if(null!==e)for(var o=0;o<e.length;++o){e[o].remove(this)}if(n(s))try{s.call(this)}catch(t){r=t instanceof h?f(t.errors):[t]}if(u(i)){o=-1;for(var a=i.length;++o<a;){var l=i[o];if(c(l))try{l.unsubscribe()}catch(t){r=r||[],t instanceof h?r=r.concat(f(t.errors)):r.push(t)}}}if(r)throw new h(r)}},t.prototype.add=function(r){var e=r;if(!r)return t.EMPTY;switch(typeof r){case"function":e=new t(r);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof t)){var n=e;(e=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}var s=e._parentOrParents;if(null===s)e._parentOrParents=this;else if(s instanceof t){if(s===this)return e;e._parentOrParents=[s,this]}else{if(-1!==s.indexOf(this))return e;s.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[e]:i.push(e),e},t.prototype.remove=function(t){var r=this._subscriptions;if(r){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,r){return t.concat(r instanceof h?r.errors:r)}),[])}var p=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),d=function(t){function r(e,n,s){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=a;break;case 1:if(!e){i.destination=a;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(i)):(i.syncErrorThrowable=!0,i.destination=new b(i,e));break}default:i.syncErrorThrowable=!0,i.destination=new b(i,e,n,s)}return i}return e(r,t),r.prototype[p]=function(){return this},r.create=function(t,e,n){var s=new r(t,e,n);return s.syncErrorThrowable=!1,s},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(l),b=function(t){function r(r,e,s,i){var o,u=t.call(this)||this;u._parentSubscriber=r;var c=u;return n(e)?o=e:e&&(o=e.next,s=e.error,i=e.complete,e!==a&&(n((c=Object.create(e)).unsubscribe)&&u.add(c.unsubscribe.bind(c)),c.unsubscribe=u.unsubscribe.bind(u))),u._context=c,u._next=o,u._error=s,u._complete=i,u}return e(r,t),r.prototype.next=function(t){if(!this.isStopped&&this._next){var r=this._parentSubscriber;i.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?this.__tryOrSetError(r,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},r.prototype.error=function(t){if(!this.isStopped){var r=this._parentSubscriber,e=i.useDeprecatedSynchronousErrorHandling;if(this._error)e&&r.syncErrorThrowable?(this.__tryOrSetError(r,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(r.syncErrorThrowable)e?(r.syncErrorValue=t,r.syncErrorThrown=!0):o(t),this.unsubscribe();else{if(this.unsubscribe(),e)throw t;o(t)}}},r.prototype.complete=function(){var t=this;if(!this.isStopped){var r=this._parentSubscriber;if(this._complete){var e=function(){return t._complete.call(t._context)};i.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?(this.__tryOrSetError(r,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},r.prototype.__tryOrUnsub=function(t,r){try{t.call(this._context,r)}catch(t){if(this.unsubscribe(),i.useDeprecatedSynchronousErrorHandling)throw t;o(t)}},r.prototype.__tryOrSetError=function(t,r,e){if(!i.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{r.call(this._context,e)}catch(r){return i.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(o(r),!0)}return!1},r.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},r}(d);var v=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function y(t){return t}function _(t){return 0===t.length?y:1===t.length?t[0]:function(r){return t.reduce((function(t,r){return r(t)}),r)}}var m=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(t,r,e){var n=this.operator,s=function(t,r,e){if(t){if(t instanceof d)return t;if(t[p])return t[p]()}return t||r||e?new d(t,r,e):new d(a)}(t,r,e);if(n?s.add(n.call(s,this.source)):s.add(this.source||i.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),i.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){i.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),!function(t){for(;t;){var r=t,e=r.closed,n=r.destination,s=r.isStopped;if(e||s)return!1;t=n&&n instanceof d?n:null}return!0}(t)?console.warn(r):t.error(r)}},t.prototype.forEach=function(t,r){var e=this;return new(r=g(r))((function(r,n){var s;s=e.subscribe((function(r){try{t(r)}catch(t){n(t),s&&s.unsubscribe()}}),n,r)}))},t.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},t.prototype[v]=function(){return this},t.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 0===t.length?this:_(t)(this)},t.prototype.toPromise=function(t){var r=this;return new(t=g(t))((function(t,e){var n;r.subscribe((function(t){return n=t}),(function(t){return e(t)}),(function(){return t(n)}))}))},t.create=function(r){return new t(r)},t}();function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var w=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),S=function(t){function r(r,e){var n=t.call(this)||this;return n.subject=r,n.subscriber=e,n.closed=!1,n}return e(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,r=t.observers;if(this.subject=null,r&&0!==r.length&&!t.isStopped&&!t.closed){var e=r.indexOf(this.subscriber);-1!==e&&r.splice(e,1)}}},r}(l),x=function(t){function r(r){var e=t.call(this,r)||this;return e.destination=r,e}return e(r,t),r}(d),E=function(t){function r(){var r=t.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e(r,t),r.prototype[p]=function(){return new x(this)},r.prototype.lift=function(t){var r=new j(this,this);return r.operator=t,r},r.prototype.next=function(t){if(this.closed)throw new w;if(!this.isStopped)for(var r=this.observers,e=r.length,n=r.slice(),s=0;s<e;s++)n[s].next(t)},r.prototype.error=function(t){if(this.closed)throw new w;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var r=this.observers,e=r.length,n=r.slice(),s=0;s<e;s++)n[s].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new w;this.isStopped=!0;for(var t=this.observers,r=t.length,e=t.slice(),n=0;n<r;n++)e[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(r){if(this.closed)throw new w;return t.prototype._trySubscribe.call(this,r)},r.prototype._subscribe=function(t){if(this.closed)throw new w;return this.hasError?(t.error(this.thrownError),l.EMPTY):this.isStopped?(t.complete(),l.EMPTY):(this.observers.push(t),new S(this,t))},r.prototype.asObservable=function(){var t=new m;return t.source=this,t},r.create=function(t,r){return new j(t,r)},r}(m),j=function(t){function r(r,e){var n=t.call(this)||this;return n.destination=r,n.source=e,n}return e(r,t),r.prototype.next=function(t){var r=this.destination;r&&r.next&&r.next(t)},r.prototype.error=function(t){var r=this.destination;r&&r.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):l.EMPTY},r}(E),k=function(t){function r(r){var e=t.call(this)||this;return e._value=r,e}return e(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(r){var e=t.prototype._subscribe.call(this,r);return e&&!e.closed&&r.next(this._value),e},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new w;return this._value},r.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},r}(E);function O(t,r){return function(e){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new P(t,r))}}var P=function(){function t(t,r){this.project=t,this.thisArg=r}return t.prototype.call=function(t,r){return r.subscribe(new $(t,this.project,this.thisArg))},t}(),$=function(t){function r(r,e,n){var s=t.call(this,r)||this;return s.project=e,s.count=0,s.thisArg=n||s,s}return e(r,t),r.prototype._next=function(t){var r;try{r=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(r)},r}(d),T=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t,r,e,n,s){this.destination.next(r)},r.prototype.notifyError=function(t,r){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(d),A=function(t){function r(r,e,n){var s=t.call(this)||this;return s.parent=r,s.outerValue=e,s.outerIndex=n,s.index=0,s}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(d);function V(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var M=V();var z=function(t){if(t&&"function"==typeof t[v])return i=t,function(t){var r=i[v]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)};if((s=t)&&"number"==typeof s.length&&"function"!=typeof s)return n=t,function(t){for(var r=0,e=n.length;r<e&&!t.closed;r++)t.next(n[r]);t.complete()};if(function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}(t))return e=t,function(t){return e.then((function(r){t.closed||(t.next(r),t.complete())}),(function(r){return t.error(r)})).then(null,o),t};if(t&&"function"==typeof t[M])return r=t,function(t){for(var e=r[M]();;){var n=e.next();if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof e.return&&t.add((function(){e.return&&e.return()})),t};var r,e,n,s,i,a=c(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+a+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};var C=function(){function t(t,r){this.keySelector=t,this.flushes=r}return t.prototype.call=function(t,r){return r.subscribe(new D(t,this.keySelector,this.flushes))},t}(),D=function(t){function r(r,e,n){var s=t.call(this,r)||this;return s.keySelector=e,s.values=new Set,n&&s.add(function(t,r,e,n,s){if(void 0===s&&(s=new A(t,e,n)),!s.closed)return r instanceof m?r.subscribe(s):z(r)(s)}(s,n)),s}return e(r,t),r.prototype.notifyNext=function(t,r,e,n,s){this.values.clear()},r.prototype.notifyError=function(t,r){this._error(t)},r.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},r.prototype._useKeySelector=function(t){var r,e=this.destination;try{r=this.keySelector(t)}catch(t){return void e.error(t)}this._finalizeNext(r,t)},r.prototype._finalizeNext=function(t,r){var e=this.values;e.has(t)||(e.add(t),this.destination.next(r))},r}(T);var N=function(){function t(t,r){this.compare=t,this.keySelector=r}return t.prototype.call=function(t,r){return r.subscribe(new B(t,this.compare,this.keySelector))},t}(),B=function(t){function r(r,e,n){var s=t.call(this,r)||this;return s.keySelector=n,s.hasKey=!1,"function"==typeof e&&(s.compare=e),s}return e(r,t),r.prototype.compare=function(t,r){return t===r},r.prototype._next=function(t){var r;try{var e=this.keySelector;r=e?e(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,r)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=r,this.destination.next(t))},r}(d);var q=function(){function t(){}return t.prototype.call=function(t,r){return r.subscribe(new H(t))},t}(),H=function(t){function r(r){var e=t.call(this,r)||this;return e.hasPrev=!1,e}return e(r,t),r.prototype._next=function(t){var r;this.hasPrev?r=[this.prev,t]:this.hasPrev=!0,this.prev=t,r&&this.destination.next(r)},r}(d);var F=function(t){return t},I=Array.isArray,U="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var R="object"==typeof U&&U&&U.Object===Object&&U,Y="object"==typeof self&&self&&self.Object===Object&&self,K=R||Y||Function("return this")(),J=K.Symbol,L=Object.prototype,G=L.hasOwnProperty,Q=L.toString,W=J?J.toStringTag:void 0;var X=function(t){var r=G.call(t,W),e=t[W];try{t[W]=void 0;var n=!0}catch(t){}var s=Q.call(t);return n&&(r?t[W]=e:delete t[W]),s},Z=Object.prototype.toString;var tt=function(t){return Z.call(t)},rt="[object Null]",et="[object Undefined]",nt=J?J.toStringTag:void 0;var st=function(t){return null==t?void 0===t?et:rt:nt&&nt in Object(t)?X(t):tt(t)};var it=function(t){return null!=t&&"object"==typeof t},ot="[object Symbol]";var at=function(t){return"symbol"==typeof t||it(t)&&st(t)==ot},ut=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ct=/^\w*$/;var ht=function(t,r){if(I(t))return!1;var e=typeof t;return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!at(t))||(ct.test(t)||!ut.test(t)||null!=r&&t in Object(r))};var lt=function(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)},ft="[object AsyncFunction]",pt="[object Function]",dt="[object GeneratorFunction]",bt="[object Proxy]";var vt,yt=function(t){if(!lt(t))return!1;var r=st(t);return r==pt||r==dt||r==ft||r==bt},_t=K["__core-js_shared__"],mt=(vt=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||""))?"Symbol(src)_1."+vt:"";var gt=function(t){return!!mt&&mt in t},wt=Function.prototype.toString;var St=function(t){if(null!=t){try{return wt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},xt=/^\[object .+?Constructor\]$/,Et=Function.prototype,jt=Object.prototype,kt=Et.toString,Ot=jt.hasOwnProperty,Pt=RegExp("^"+kt.call(Ot).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var $t=function(t){return!(!lt(t)||gt(t))&&(yt(t)?Pt:xt).test(St(t))};var Tt=function(t,r){return null==t?void 0:t[r]};var At=function(t,r){var e=Tt(t,r);return $t(e)?e:void 0},Vt=At(Object,"create");var Mt=function(){this.__data__=Vt?Vt(null):{},this.size=0};var zt=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},Ct="__lodash_hash_undefined__",Dt=Object.prototype.hasOwnProperty;var Nt=function(t){var r=this.__data__;if(Vt){var e=r[t];return e===Ct?void 0:e}return Dt.call(r,t)?r[t]:void 0},Bt=Object.prototype.hasOwnProperty;var qt=function(t){var r=this.__data__;return Vt?void 0!==r[t]:Bt.call(r,t)},Ht="__lodash_hash_undefined__";var Ft=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=Vt&&void 0===r?Ht:r,this};function It(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}It.prototype.clear=Mt,It.prototype.delete=zt,It.prototype.get=Nt,It.prototype.has=qt,It.prototype.set=Ft;var Ut=It;var Rt=function(){this.__data__=[],this.size=0};var Yt=function(t,r){return t===r||t!=t&&r!=r};var Kt=function(t,r){for(var e=t.length;e--;)if(Yt(t[e][0],r))return e;return-1},Jt=Array.prototype.splice;var Lt=function(t){var r=this.__data__,e=Kt(r,t);return!(e<0)&&(e==r.length-1?r.pop():Jt.call(r,e,1),--this.size,!0)};var Gt=function(t){var r=this.__data__,e=Kt(r,t);return e<0?void 0:r[e][1]};var Qt=function(t){return Kt(this.__data__,t)>-1};var Wt=function(t,r){var e=this.__data__,n=Kt(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};function Xt(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}Xt.prototype.clear=Rt,Xt.prototype.delete=Lt,Xt.prototype.get=Gt,Xt.prototype.has=Qt,Xt.prototype.set=Wt;var Zt=Xt,tr=At(K,"Map");var rr=function(){this.size=0,this.__data__={hash:new Ut,map:new(tr||Zt),string:new Ut}};var er=function(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var nr=function(t,r){var e=t.__data__;return er(r)?e["string"==typeof r?"string":"hash"]:e.map};var sr=function(t){var r=nr(this,t).delete(t);return this.size-=r?1:0,r};var ir=function(t){return nr(this,t).get(t)};var or=function(t){return nr(this,t).has(t)};var ar=function(t,r){var e=nr(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};function ur(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}ur.prototype.clear=rr,ur.prototype.delete=sr,ur.prototype.get=ir,ur.prototype.has=or,ur.prototype.set=ar;var cr=ur,hr="Expected a function";function lr(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError(hr);var e=function(){var n=arguments,s=r?r.apply(this,n):n[0],i=e.cache;if(i.has(s))return i.get(s);var o=t.apply(this,n);return e.cache=i.set(s,o)||i,o};return e.cache=new(lr.Cache||cr),e}lr.Cache=cr;var fr=lr,pr=500;var dr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,br=/\\(\\)?/g,vr=function(t){var r=fr(t,(function(t){return e.size===pr&&e.clear(),t})),e=r.cache;return r}((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(dr,(function(t,e,n,s){r.push(n?s.replace(br,"$1"):e||t)})),r}));var yr=function(t,r){for(var e=-1,n=null==t?0:t.length,s=Array(n);++e<n;)s[e]=r(t[e],e,t);return s},_r=1/0,mr=J?J.prototype:void 0,gr=mr?mr.toString:void 0;var wr=function t(r){if("string"==typeof r)return r;if(I(r))return yr(r,t)+"";if(at(r))return gr?gr.call(r):"";var e=r+"";return"0"==e&&1/r==-_r?"-0":e};var Sr=function(t){return null==t?"":wr(t)};var xr=function(t,r){return I(t)?t:ht(t,r)?[t]:vr(Sr(t))},Er=1/0;var jr=function(t){if("string"==typeof t||at(t))return t;var r=t+"";return"0"==r&&1/t==-Er?"-0":r};var kr=function(t,r){for(var e=0,n=(r=xr(r,t)).length;null!=t&&e<n;)t=t[jr(r[e++])];return e&&e==n?t:void 0};var Or=function(t,r,e){var n=null==t?void 0:kr(t,r);return void 0===n?e:n};const Pr=Symbol("ABSENT"),$r=t=>t&&t!==Pr,Tr=t=>t!==Pr&&void 0!==t,Ar=t=>t!==Pr,Vr=t=>t===Pr,Mr=new Map,zr=(t,r,e=!1)=>{if(r&&"function"==typeof r){if(Mr.has(t)&&!e){if(Mr.get(t)!==r)throw new Error(`cannot redefine ${t}`)}else Mr.set(t,r);return zr}return Mr.get(t)};zr("string",t=>"string"!=typeof t&&"value must be a string"),zr("number",t=>"number"!=typeof t&&"value must be a number"),zr("nan",t=>"number"==typeof t&&!Number.isNaN(t)&&"value must be not a number"),zr("integer",t=>!Number.isSafeInteger(t)&&"value must be an integer"),zr("array",t=>!Array.isArray(t)&&"value must be an array"),zr("object",t=>!($r(t)&&"object"==typeof t&&!Array.isArray(t))&&"value must be an object"),zr("function",t=>(!t||"function"!=typeof t)&&"value must be a function"),zr.is=(t,r=Pr)=>Vr(r)?r=>zr.is(t,r):!zr(t)(r);var Cr=function(){try{var t=At(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Dr=function(t,r,e){"__proto__"==r&&Cr?Cr(t,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[r]=e},Nr=Object.prototype.hasOwnProperty;var Br=function(t,r,e){var n=t[r];Nr.call(t,r)&&Yt(n,e)&&(void 0!==e||r in t)||Dr(t,r,e)},qr=9007199254740991,Hr=/^(?:0|[1-9]\d*)$/;var Fr=function(t,r){var e=typeof t;return!!(r=null==r?qr:r)&&("number"==e||"symbol"!=e&&Hr.test(t))&&t>-1&&t%1==0&&t<r};var Ir=function(t,r,e,n){if(!lt(t))return t;for(var s=-1,i=(r=xr(r,t)).length,o=i-1,a=t;null!=a&&++s<i;){var u=jr(r[s]),c=e;if(s!=o){var h=a[u];void 0===(c=n?n(h,u,a):void 0)&&(c=lt(h)?h:Fr(r[s+1])?[]:{})}Br(a,u,c),a=a[u]}return t};var Ur=function(t,r,e){for(var n=-1,s=r.length,i={};++n<s;){var o=r[n],a=kr(t,o);e(a,o)&&Ir(i,xr(o,t),a)}return i};var Rr=function(t,r){return null!=t&&r in Object(t)},Yr="[object Arguments]";var Kr=function(t){return it(t)&&st(t)==Yr},Jr=Object.prototype,Lr=Jr.hasOwnProperty,Gr=Jr.propertyIsEnumerable,Qr=Kr(function(){return arguments}())?Kr:function(t){return it(t)&&Lr.call(t,"callee")&&!Gr.call(t,"callee")},Wr=9007199254740991;var Xr=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Wr};var Zr=function(t,r,e){for(var n=-1,s=(r=xr(r,t)).length,i=!1;++n<s;){var o=jr(r[n]);if(!(i=null!=t&&e(t,o)))break;t=t[o]}return i||++n!=s?i:!!(s=null==t?0:t.length)&&Xr(s)&&Fr(o,s)&&(I(t)||Qr(t))};var te=function(t,r){return null!=t&&Zr(t,r,Rr)};var re=function(t,r){return Ur(t,r,(function(r,e){return te(t,e)}))};var ee=function(t,r){for(var e=-1,n=r.length,s=t.length;++e<n;)t[s+e]=r[e];return t},ne=J?J.isConcatSpreadable:void 0;var se=function(t){return I(t)||Qr(t)||!!(ne&&t&&t[ne])};var ie=function t(r,e,n,s,i){var o=-1,a=r.length;for(n||(n=se),i||(i=[]);++o<a;){var u=r[o];e>0&&n(u)?e>1?t(u,e-1,n,s,i):ee(i,u):s||(i[i.length]=u)}return i};var oe=function(t){return(null==t?0:t.length)?ie(t,1):[]};var ae=function(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)},ue=Math.max;var ce=function(t,r,e){return r=ue(void 0===r?t.length-1:r,0),function(){for(var n=arguments,s=-1,i=ue(n.length-r,0),o=Array(i);++s<i;)o[s]=n[r+s];s=-1;for(var a=Array(r+1);++s<r;)a[s]=n[s];return a[r]=e(o),ae(t,this,a)}};var he=function(t){return function(){return t}},le=Cr?function(t,r){return Cr(t,"toString",{configurable:!0,enumerable:!1,value:he(r),writable:!0})}:F,fe=800,pe=16,de=Date.now;var be=function(t){var r=0,e=0;return function(){var n=de(),s=pe-(n-e);if(e=n,s>0){if(++r>=fe)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(le);var ve=function(t){return be(ce(t,void 0,oe),t+"")}((function(t,r){return null==t?{}:re(t,r)}));class ye{constructor(t,r=Pr){this.value=t,Tr(r)&&("string"==typeof r.name&&(this.name=r.name),this.trans=!!r.trans,this.prev=r.prev,this.error=r.error,this.target=r.target,this.blocker=!!r.blocker,this.virtual=!!r.virtual)}get message(){return this.error?"string"==typeof this.error?this.error:"object"==typeof this.error&&this.error.error&&"string"==typeof this.error.error?this.error.error:"":""}toJSON(){const t=ve(this,"target,name,value,complete,prev,trans,error".split(","));return t.message=this.message,"object"==typeof t.target&&t.target.name&&(t.target=t.target.name),this.blocker&&(t.blocker=!0),this.virtual&&(t.virtual=!0),t}}t.proppify(ye).addProp("target",null).addProp("name","").addProp("blocker",!1,"boolean").addProp("value",null).addProp("complete",!1).addProp("prev",Pr).addProp("trans",!1,"boolean").addProp("virtual",!1,"boolean").addProp("error",null);var _e=1/0;var me=function(t){return(null==t?0:t.length)?ie(t,_e):[]};function ge(t,r="invalid ValueStream name"){if(!t||!Tr(t)||"string"!=typeof t&&"number"!=typeof t){const e=new Error(r);throw Ar(t)?e.name=t:e.name=void 0,e}}const we=/^!(.*)$/;class Se{constructor(t=Pr,r=Pr,e=Pr){this.name=t,this._value=Pr;try{this._setValue(r)}catch(t){this._value=Pr}$r(e)&&(this.filter=e)}get name(){return this._name}set name(t){ge(t,"cannot initialize ValueStream with bad name"),this._name=t}hasValidName(){try{return ge(this.name),!0}catch(t){return!1}}get value(){if(this._value!==Pr)return this._value}_setValue(t){let r=this.validate(t,!0);if(r){Array.isArray(r)&&(r=r.join(", "));const t=new Error(`attempt to set ${this.name} to bad value`);throw t.error=r,t}this._value=t}validate(t=Pr,r=!1){try{if(Vr(t)&&(t=this.value),Vr(t))return r?null:[];if(!$r(this.filter)||Vr(t))return!1;const e=me([this.filter]),n=this._validateList(e,t);return r?!!n.length&&(1===n.length?n.pop():n):n}catch(t){console.log("error validating type:",t)}return!1}_validateList(t,r){return t.reduce((t,e)=>{const n=this._validateFilter(e,r,t);return n?[...t,n]:t},[])}_validateInverse(t,r,e){const n=we.exec(t)[1];return!this._validateFilter(n,r,e)&&`${this.name} cannot be a ${n}`}_validateFilter(t,r,e){if("function"==typeof t)return t(r,e,this);if("string"==typeof t){if(we.test(t))return this._validateInverse(t,r,e);const n=zr(t);if(!n)return`there is no validator named ${t}`;if(n(r))return`${this.name} must be a ${t}`}return"object"==typeof t&&t.validate(r,e,this)}}t.proppify(Se).addProp("filter",Pr);class xe extends Se{constructor(t=Pr,r=Pr,e=Pr){super(t,r,e)}get $changes(){return this._changes||(this._changes=new E),this._changes}next(...t){let r=!1;try{r=this.makeMessage(...t),this.isComplete?r.error="Attempt to update a completed stream":this.$requests.next(r)}catch(t){(r=t).error=t.message}return r}nextPromise(...t){let r;try{r=this.next(...t)}catch(t){(r=t).error=t.message}return new Promise((t,e)=>{r.error?e(r):t(r)})}makeMessage(t=Pr,r=Pr){const e=$r(r)&&"object"==typeof r?r:{};return new ye(t,{...e,name:this.name,target:this})}get $requests(){return this.__requests||(this.__requests=new E,this.subSet.add(this.__requests.subscribe(this._onRequest.bind(this),t=>{console.log("request submission error:",t)}))),this.__requests}get _$blockers(){return this._blockers||(this._blockers=new Set),this._blockers}get hasBlockers(){return!!Or(this,"parent.hasBlockers")||!!this._blockers&&this._$blockers.size>0}block(t=Pr){return $r(t)||(t=this.makeMessage("blocker",{blocker:!0,target:this})),this._$blockers.add(t),t}unblock(t){t&&this.hasBlockers&&(this._$blockers.delete(t),this.parent&&this.parent.unblock&&this.parent.unblock(t))}_onRequest(t){if(this.hasBlockers)throw t.error=new Error("cannot execute requests on a blocked ValueStream"),this.errors.next(t),t;if(t.complete||Vr(t.value))return t;t.prev=this.value,t.trans&&t.startTrans();try{this._setValue(t.value)}catch({message:r,error:e}){t.error=e||r,this.errors.next(t)}return t.error?(t.trans&&this.endTrans(t),t):(this.$changes.next(t),this.hasTranses?this.pendingChanges=!0:this._broadcastChange(t),t.trans&&this.endTrans(t),t)}_broadcastChange(t){this.$updateStream.next(t)}get errors(){var t,r;return this._errors||(this._errors=(new E).pipe((function(e){return e.lift(new C(t,r))}))),this._errors}flushTranses(){let t=[];return this._transes&&(t=Array.from(this._transes.values()),this._transes.clear()),t}get hasTranses(){return!!this._transes&&this._transes.size}get _$transes(){return this.hasTranses||(this._transes=new Set),this._transes}startTrans(t){return t||(t=this.makeMessage(Pr,{trans:!0,target:this})),this._$transes.add(t),this._broadcastTrans(),t}endTrans(t){t&&(this.parent&&this.parent.endTrans&&this.parent.endTrans(t),this._$transes.has(t)&&(this._$transes.delete(t),this._broadcastTrans()))}_broadcastTrans(){this._$transStream.next(this._$transes.size)}get _$transStream(){return this.__transStream||(this.__transStream=new k(this._$transes.size),this.subSet.add(this.__transStream.pipe((function(t){return t.lift(new q)})).subscribe(([t,r])=>{this.pendingChanges&&t&&!r&&(this.pendingChanges=!1,this._broadcastChange())}))),this.__transStream}get $updateStream(){return this.__updater||(this.__updater=new k(this)),this.__updater}subscribe(t=F,r=F,e=F){r&&this.subSet.add(this.errors.subscribe(r,r));const n=this.$updateStream.subscribe(()=>{t(this)},r,e);return this.subSet.add(n),n}get isComplete(){return!!this._completed}complete(){this._completed=!0;try{Array.from(this.subSet).forEach(t=>{t.unsubscribe(),this.subSet.delete(t)})}catch(t){console.log("complete error: ",t)}}}t.proppify(xe).addProp("pendingChanges",!1,"boolean").addProp("parent",null).addProp("subSet",()=>new Set);var Ee=function(t,r,e){var n=-1,s=t.length;r<0&&(r=-r>s?0:s+r),(e=e>s?s:e)<0&&(e+=s),s=r>e?0:e-r>>>0,r>>>=0;for(var i=Array(s);++n<s;)i[n]=t[n+r];return i};var je=function(t,r,e){var n=t.length;return e=void 0===e?n:e,!r&&e>=n?t:Ee(t,r,e)},ke=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Oe=function(t){return ke.test(t)};var Pe=function(t){return t.split("")},$e="[\\ud800-\\udfff]",Te="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ae="\\ud83c[\\udffb-\\udfff]",Ve="[^\\ud800-\\udfff]",Me="(?:\\ud83c[\\udde6-\\uddff]){2}",ze="[\\ud800-\\udbff][\\udc00-\\udfff]",Ce="(?:"+Te+"|"+Ae+")"+"?",De="[\\ufe0e\\ufe0f]?"+Ce+("(?:\\u200d(?:"+[Ve,Me,ze].join("|")+")[\\ufe0e\\ufe0f]?"+Ce+")*"),Ne="(?:"+[Ve+Te+"?",Te,Me,ze,$e].join("|")+")",Be=RegExp(Ae+"(?="+Ae+")|"+Ne+De,"g");var qe=function(t){return t.match(Be)||[]};var He=function(t){return Oe(t)?qe(t):Pe(t)};var Fe=function(t){return function(r){r=Sr(r);var e=Oe(r)?He(r):void 0,n=e?e[0]:r.charAt(0),s=e?je(e,1).join(""):r.slice(1);return n[t]()+s}}("toUpperCase"),Ie=function(t,r){return t(r={exports:{}},r.exports),r.exports}((function(t,r){function e(t,r){var e=[],n=[];return null==r&&(r=function(t,r){return e[0]===r?"[Circular ~]":"[Circular ~."+n.slice(0,e.indexOf(r)).join(".")+"]"}),function(s,i){if(e.length>0){var o=e.indexOf(this);~o?e.splice(o+1):e.push(this),~o?n.splice(o,1/0,s):n.push(s),~e.indexOf(i)&&(i=r.call(this,s,i))}else e.push(i);return null==t?i:t.call(this,s,i)}}(t.exports=function(t,r,n,s){return JSON.stringify(t,e(r,s),n)}).getSerialize=e}));Ie.getSerialize;const Ue="undefined"!=typeof Proxy;class Re extends xe{constructor(t,r=Pr,e=Pr,n=Pr){super(t),zr.is("object",r)&&this._initValues(r),zr.is("object",e)&&this._initMethods(e),zr.is("object",n)&&this._initVirtuals(n),this.next(this.value)}_initVirtuals(t){Object.keys(t).forEach(r=>{const e=t[r];this.addVirtual(r,e)})}addVirtual(t,r,e=!1){try{if(!zr.is("function",r))throw new Error("non-function supplied as virtual value");if(!e&&this._$virtuals.has(t))throw new Error(`cannot redefine ${t}`);this._$virtuals.set(t,(...e)=>this.derive(r,t,...e))}catch(n){console.error("error defining virtual:",t,r,e,n)}return this}_findSV(t){const r=[],e=[];return me(t).forEach(t=>{t&&(this.streams.has(t)?r.push(t):this._$virtuals.has(t)&&e.push(t))}),{streams:r,virtuals:e}}_expressor(t,r){return()=>{try{const e=r.length?this.deriveAll(r):new Map;t.forEach(t=>e.set(t,this.my[t]));const n={};return e.forEach((t,r)=>{n[r]=t}),n}catch(t){return console.error("error expressing watched data:",t),{}}}}watch(t,r,...e){if(!r)throw new Error("watch requires fields to be defined");try{if(!zr.is("function",t))throw new Error("first argument to watch must be a function");zr.is("function",r)||(e.unshift(r),r=Ie);const{streams:i,virtuals:o}=this._findSV(e),a=this._expressor(i,o),u=new k(a()),c=this.$changes.pipe(O(a)).subscribe(t=>u.next(t));this.subSet.add(c);const h=u.pipe((n=(t,r)=>t===r,s=t=>r(t),function(t){return t.lift(new N(n,s))})).subscribe(r=>{t(r,this)});return this.subSet.add(h),h}catch(t){return console.error("error in watch: ",t),null}var n,s}_initMethods(t){Object.keys(t).forEach(r=>{const e=t[r];Array.isArray(e)?this.addMethod(r,...e):this.addMethod(r,e)})}_initValues(t){Object.keys(t).forEach(r=>{const e=t[r];Array.isArray(e)?this.addStream(r,...e):this.addStream(r,e)})}setFilter(t,r){return this.streams[t].filter=r,this}_updateStreamValue(t,r){this.streams.get(t).next(r)}get _$virtuals(){return this._virtuals||(this._virtuals=new Map),this._virtuals}get hasVirtuals(){return this._virtuals&&this._$virtuals.size}hasVirtual(t){return!!this.hasVirtuals&&this._$virtuals.has(t)}derive(t,r,...e){if(!zr.is("function",t))throw new Error("derive requires a function");const n=this.makeMessage({name:r,fn:t},{virtual:!0,blocker:!0}),s=this._getBlocker(r);if(s)throw n.error={error:"circular virtual",circular:s},n;this.block(n);const i=this._try(t,this,...e);return this.unblock(n),i}_getBlocker(t){let r=!1;return this.hasBlockers&&this._$blockers.forEach(e=>{!r&&e.virtual&&e.name===t&&(r=e)}),r}deriveAll(t=Pr){const r=new Map;return this._$virtuals.forEach((e,n)=>{Array.isArray(t)&&!t.includes(n)||r.set(n,this._try(e,this))}),r}get value(){return this._genValue()}get my(){return Ue?(this._valueProxy||(this._valueProxy=this._genValueProxy()),this._valueProxy):this._genValue()}_genValueProxy(){const t=this;return new Proxy({},{get(r,e){if(t.streams.has(e)){return t.streams.get(e).value}if(t.hasVirtuals&&t._$virtuals.has(e))return t._$virtuals.get(e)()}})}_genValue(){const t={};if(this.streams.forEach(r=>{t[r.name]=r.value}),!this.hasBlockers){this.deriveAll().forEach((r,e)=>{try{t.hasOwnProperty(e)||(t[e]=r)}catch(t){console.error("cannot attach virtual - conflicts with existing stream",e)}})}return t}clearCache(){delete this._valueProxy,delete this._do,delete this._propSetters}addProperty(...t){return this.addStream(...t)}property(...t){return this.addStream(...t)}get $updateStream(){return super.$updateStream.pipe(O(()=>this))}addStream(t,r=Pr,e=Pr){if(this.streams.has(t))throw new Error(`${this.name}: cannot redefine property ${t}`);const n=new xe(t,r,e);return n.parent=this,this.subSet.add(n.subscribe(()=>{this.next(this.value)},t=>{t instanceof ye&&(t=t.toJSON()),this.errors.next({store:this.name,source:n.name,error:t})})),this.streams.set(t,n),delete this._propSetters,this.clearCache(),this}method(...t){return this.addMethod(...t)}addMethod(t,r,e=Pr){const n=Or(e,"bind",!1),s=Or(e,"trans",!1),i=Or(e,"throws",!1);if(this.methods.has(t))throw new Error(`${this.name}: cannot redefine method ${t}`);const o=n?r.bind(this):(...t)=>r(this,...t);return i?this.methods.set(t,(...t)=>s?this.throwTrans(o,...t):this.throws(o,...t)):this.methods.set(t,(...t)=>s?this._tryTrans(o,...t):this.try(o,...t)),this.clearCache(),this}_tryTrans(t,...r){if(this.hasBlockers)throw new Error("cannot execute methods while blocked");const e=this.startTrans(),n=this.try(t,...r);return this.endTrans(e),n}try(t,...r){if(this.hasBlockers)throw new Error("cannot execute methods while blocked");return this._try(t,...r)}_try(t,...r){let e;try{e=t(...r)}catch(t){this.errors.next(t)}return e}throws(t,...r){if(this.hasBlockers)throw new Error("cannot execute methods while blocked");let e,n=!1,s=this.subscribe(()=>{},t=>{n=t});try{e=t(...r)}catch(t){s.unsubscribe(),s=null,t!==n&&(this.errors.next(t),n=t)}if(s&&s.unsubscribe(),n)throw n;return e}throwTrans(t,...r){if(this.hasBlockers)throw new Error("cannot execute methods while blocked");let e;const n=this.startTrans();let s=!1;try{e=this.throws(t,...r)}catch(t){s=t}if(this.endTrans(n),s)throw s;return e}get do(){return this._do||(this._do=Ue?this._genDoProxy():this._genDo()),this._do}get _$propSetters(){return this._propSetters||(this._propSetters={},this.streams.forEach(t=>{const r=`set${Fe(t.name)}`;this._propSetters[r]=r=>t.next(r);const e=`${r}_ot`;this._propSetters[e]=t=>this.throws(()=>this._propSetters[r](t))})),this._propSetters}_genDoProxy(){const t=this;return new Proxy({},{get:(r,e)=>t._$propSetters[e]?t._$propSetters[e]:t.methods.get(e)})}_genDo(){const t={...this._$propSetters};return this.methods.forEach((r,e)=>{t[e]=r}),t}}return t.proppify(Re).addProp("methods",()=>new Map).addProp("streams",()=>new Map),{ValueStream:xe,Value:Se,ValueStore:Re,ABSENT:Pr,validators:zr}}));
