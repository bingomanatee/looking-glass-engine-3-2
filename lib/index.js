!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("@wonderlandlabs/propper")):"function"==typeof define&&define.amd?define(["@wonderlandlabs/propper"],r):(t=t||self).LGE=r(t.propper)}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(t,e)};function e(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t){return"function"==typeof t}var s=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;s=t},get useDeprecatedSynchronousErrorHandling(){return s}};function i(t){setTimeout((function(){throw t}),0)}var a={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;i(t)},complete:function(){}},u=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function c(t){return null!==t&&"object"==typeof t}var h=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,r){return r+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),l=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var r;if(!this.closed){var e=this._parentOrParents,s=this._unsubscribe,o=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof t)e.remove(this);else if(null!==e)for(var i=0;i<e.length;++i){e[i].remove(this)}if(n(s))try{s.call(this)}catch(t){r=t instanceof h?f(t.errors):[t]}if(u(o)){i=-1;for(var a=o.length;++i<a;){var l=o[i];if(c(l))try{l.unsubscribe()}catch(t){r=r||[],t instanceof h?r=r.concat(f(t.errors)):r.push(t)}}}if(r)throw new h(r)}},t.prototype.add=function(r){var e=r;if(!r)return t.EMPTY;switch(typeof r){case"function":e=new t(r);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof t)){var n=e;(e=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}var s=e._parentOrParents;if(null===s)e._parentOrParents=this;else if(s instanceof t){if(s===this)return e;e._parentOrParents=[s,this]}else{if(-1!==s.indexOf(this))return e;s.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[e]:o.push(e),e},t.prototype.remove=function(t){var r=this._subscriptions;if(r){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,r){return t.concat(r instanceof h?r.errors:r)}),[])}var p=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),d=function(t){function r(e,n,s){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=a;break;case 1:if(!e){o.destination=a;break}if("object"==typeof e){e instanceof r?(o.syncErrorThrowable=e.syncErrorThrowable,o.destination=e,e.add(o)):(o.syncErrorThrowable=!0,o.destination=new b(o,e));break}default:o.syncErrorThrowable=!0,o.destination=new b(o,e,n,s)}return o}return e(r,t),r.prototype[p]=function(){return this},r.create=function(t,e,n){var s=new r(t,e,n);return s.syncErrorThrowable=!1,s},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(l),b=function(t){function r(r,e,s,o){var i,u=t.call(this)||this;u._parentSubscriber=r;var c=u;return n(e)?i=e:e&&(i=e.next,s=e.error,o=e.complete,e!==a&&(n((c=Object.create(e)).unsubscribe)&&u.add(c.unsubscribe.bind(c)),c.unsubscribe=u.unsubscribe.bind(u))),u._context=c,u._next=i,u._error=s,u._complete=o,u}return e(r,t),r.prototype.next=function(t){if(!this.isStopped&&this._next){var r=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?this.__tryOrSetError(r,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},r.prototype.error=function(t){if(!this.isStopped){var r=this._parentSubscriber,e=o.useDeprecatedSynchronousErrorHandling;if(this._error)e&&r.syncErrorThrowable?(this.__tryOrSetError(r,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(r.syncErrorThrowable)e?(r.syncErrorValue=t,r.syncErrorThrown=!0):i(t),this.unsubscribe();else{if(this.unsubscribe(),e)throw t;i(t)}}},r.prototype.complete=function(){var t=this;if(!this.isStopped){var r=this._parentSubscriber;if(this._complete){var e=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?(this.__tryOrSetError(r,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},r.prototype.__tryOrUnsub=function(t,r){try{t.call(this._context,r)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;i(t)}},r.prototype.__tryOrSetError=function(t,r,e){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{r.call(this._context,e)}catch(r){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(i(r),!0)}return!1},r.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},r}(d);var v=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function y(t){return t}function _(t){return 0===t.length?y:1===t.length?t[0]:function(r){return t.reduce((function(t,r){return r(t)}),r)}}var g=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(t,r,e){var n=this.operator,s=function(t,r,e){if(t){if(t instanceof d)return t;if(t[p])return t[p]()}return t||r||e?new d(t,r,e):new d(a)}(t,r,e);if(n?s.add(n.call(s,this.source)):s.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),o.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),!function(t){for(;t;){var r=t,e=r.closed,n=r.destination,s=r.isStopped;if(e||s)return!1;t=n&&n instanceof d?n:null}return!0}(t)?console.warn(r):t.error(r)}},t.prototype.forEach=function(t,r){var e=this;return new(r=m(r))((function(r,n){var s;s=e.subscribe((function(r){try{t(r)}catch(t){n(t),s&&s.unsubscribe()}}),n,r)}))},t.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},t.prototype[v]=function(){return this},t.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 0===t.length?this:_(t)(this)},t.prototype.toPromise=function(t){var r=this;return new(t=m(t))((function(t,e){var n;r.subscribe((function(t){return n=t}),(function(t){return e(t)}),(function(){return t(n)}))}))},t.create=function(r){return new t(r)},t}();function m(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var w=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),S=function(t){function r(r,e){var n=t.call(this)||this;return n.subject=r,n.subscriber=e,n.closed=!1,n}return e(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,r=t.observers;if(this.subject=null,r&&0!==r.length&&!t.isStopped&&!t.closed){var e=r.indexOf(this.subscriber);-1!==e&&r.splice(e,1)}}},r}(l),E=function(t){function r(r){var e=t.call(this,r)||this;return e.destination=r,e}return e(r,t),r}(d),x=function(t){function r(){var r=t.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e(r,t),r.prototype[p]=function(){return new E(this)},r.prototype.lift=function(t){var r=new P(this,this);return r.operator=t,r},r.prototype.next=function(t){if(this.closed)throw new w;if(!this.isStopped)for(var r=this.observers,e=r.length,n=r.slice(),s=0;s<e;s++)n[s].next(t)},r.prototype.error=function(t){if(this.closed)throw new w;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var r=this.observers,e=r.length,n=r.slice(),s=0;s<e;s++)n[s].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new w;this.isStopped=!0;for(var t=this.observers,r=t.length,e=t.slice(),n=0;n<r;n++)e[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(r){if(this.closed)throw new w;return t.prototype._trySubscribe.call(this,r)},r.prototype._subscribe=function(t){if(this.closed)throw new w;return this.hasError?(t.error(this.thrownError),l.EMPTY):this.isStopped?(t.complete(),l.EMPTY):(this.observers.push(t),new S(this,t))},r.prototype.asObservable=function(){var t=new g;return t.source=this,t},r.create=function(t,r){return new P(t,r)},r}(g),P=function(t){function r(r,e){var n=t.call(this)||this;return n.destination=r,n.source=e,n}return e(r,t),r.prototype.next=function(t){var r=this.destination;r&&r.next&&r.next(t)},r.prototype.error=function(t){var r=this.destination;r&&r.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):l.EMPTY},r}(x),j=function(t){function r(r){var e=t.call(this)||this;return e._value=r,e}return e(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(r){var e=t.prototype._subscribe.call(this,r);return e&&!e.closed&&r.next(this._value),e},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new w;return this._value},r.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},r}(x),k=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.notifyNext=function(t,r,e,n,s){this.destination.next(r)},r.prototype.notifyError=function(t,r){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(d),O=function(t){function r(r,e,n){var s=t.call(this)||this;return s.parent=r,s.outerValue=e,s.outerIndex=n,s.index=0,s}return e(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(d);function $(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var T=$();var A=function(t){if(t&&"function"==typeof t[v])return o=t,function(t){var r=o[v]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)};if((s=t)&&"number"==typeof s.length&&"function"!=typeof s)return n=t,function(t){for(var r=0,e=n.length;r<e&&!t.closed;r++)t.next(n[r]);t.complete()};if(function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}(t))return e=t,function(t){return e.then((function(r){t.closed||(t.next(r),t.complete())}),(function(r){return t.error(r)})).then(null,i),t};if(t&&"function"==typeof t[T])return r=t,function(t){for(var e=r[T]();;){var n=e.next();if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof e.return&&t.add((function(){e.return&&e.return()})),t};var r,e,n,s,o,a=c(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+a+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};var V=function(){function t(t,r){this.keySelector=t,this.flushes=r}return t.prototype.call=function(t,r){return r.subscribe(new M(t,this.keySelector,this.flushes))},t}(),M=function(t){function r(r,e,n){var s=t.call(this,r)||this;return s.keySelector=e,s.values=new Set,n&&s.add(function(t,r,e,n,s){if(void 0===s&&(s=new O(t,e,n)),!s.closed)return r instanceof g?r.subscribe(s):A(r)(s)}(s,n)),s}return e(r,t),r.prototype.notifyNext=function(t,r,e,n,s){this.values.clear()},r.prototype.notifyError=function(t,r){this._error(t)},r.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},r.prototype._useKeySelector=function(t){var r,e=this.destination;try{r=this.keySelector(t)}catch(t){return void e.error(t)}this._finalizeNext(r,t)},r.prototype._finalizeNext=function(t,r){var e=this.values;e.has(t)||(e.add(t),this.destination.next(r))},r}(k);var z=function(){function t(){}return t.prototype.call=function(t,r){return r.subscribe(new C(t))},t}(),C=function(t){function r(r){var e=t.call(this,r)||this;return e.hasPrev=!1,e}return e(r,t),r.prototype._next=function(t){var r;this.hasPrev?r=[this.prev,t]:this.hasPrev=!0,this.prev=t,r&&this.destination.next(r)},r}(d);var D=function(t){return t},N=Array.isArray,B="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},q="object"==typeof B&&B&&B.Object===Object&&B,H="object"==typeof self&&self&&self.Object===Object&&self,F=q||H||Function("return this")(),U=F.Symbol,R=Object.prototype,Y=R.hasOwnProperty,I=R.toString,L=U?U.toStringTag:void 0;var G=function(t){var r=Y.call(t,L),e=t[L];try{t[L]=void 0;var n=!0}catch(t){}var s=I.call(t);return n&&(r?t[L]=e:delete t[L]),s},J=Object.prototype.toString;var K=function(t){return J.call(t)},Q="[object Null]",W="[object Undefined]",X=U?U.toStringTag:void 0;var Z=function(t){return null==t?void 0===t?W:Q:X&&X in Object(t)?G(t):K(t)};var tt=function(t){return null!=t&&"object"==typeof t},rt="[object Symbol]";var et=function(t){return"symbol"==typeof t||tt(t)&&Z(t)==rt},nt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,st=/^\w*$/;var ot=function(t,r){if(N(t))return!1;var e=typeof t;return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!et(t))||(st.test(t)||!nt.test(t)||null!=r&&t in Object(r))};var it=function(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)},at="[object AsyncFunction]",ut="[object Function]",ct="[object GeneratorFunction]",ht="[object Proxy]";var lt,ft=function(t){if(!it(t))return!1;var r=Z(t);return r==ut||r==ct||r==at||r==ht},pt=F["__core-js_shared__"],dt=(lt=/[^.]+$/.exec(pt&&pt.keys&&pt.keys.IE_PROTO||""))?"Symbol(src)_1."+lt:"";var bt=function(t){return!!dt&&dt in t},vt=Function.prototype.toString;var yt=function(t){if(null!=t){try{return vt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},_t=/^\[object .+?Constructor\]$/,gt=Function.prototype,mt=Object.prototype,wt=gt.toString,St=mt.hasOwnProperty,Et=RegExp("^"+wt.call(St).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var xt=function(t){return!(!it(t)||bt(t))&&(ft(t)?Et:_t).test(yt(t))};var Pt=function(t,r){return null==t?void 0:t[r]};var jt=function(t,r){var e=Pt(t,r);return xt(e)?e:void 0},kt=jt(Object,"create");var Ot=function(){this.__data__=kt?kt(null):{},this.size=0};var $t=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},Tt="__lodash_hash_undefined__",At=Object.prototype.hasOwnProperty;var Vt=function(t){var r=this.__data__;if(kt){var e=r[t];return e===Tt?void 0:e}return At.call(r,t)?r[t]:void 0},Mt=Object.prototype.hasOwnProperty;var zt=function(t){var r=this.__data__;return kt?void 0!==r[t]:Mt.call(r,t)},Ct="__lodash_hash_undefined__";var Dt=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=kt&&void 0===r?Ct:r,this};function Nt(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}Nt.prototype.clear=Ot,Nt.prototype.delete=$t,Nt.prototype.get=Vt,Nt.prototype.has=zt,Nt.prototype.set=Dt;var Bt=Nt;var qt=function(){this.__data__=[],this.size=0};var Ht=function(t,r){return t===r||t!=t&&r!=r};var Ft=function(t,r){for(var e=t.length;e--;)if(Ht(t[e][0],r))return e;return-1},Ut=Array.prototype.splice;var Rt=function(t){var r=this.__data__,e=Ft(r,t);return!(e<0)&&(e==r.length-1?r.pop():Ut.call(r,e,1),--this.size,!0)};var Yt=function(t){var r=this.__data__,e=Ft(r,t);return e<0?void 0:r[e][1]};var It=function(t){return Ft(this.__data__,t)>-1};var Lt=function(t,r){var e=this.__data__,n=Ft(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};function Gt(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}Gt.prototype.clear=qt,Gt.prototype.delete=Rt,Gt.prototype.get=Yt,Gt.prototype.has=It,Gt.prototype.set=Lt;var Jt=Gt,Kt=jt(F,"Map");var Qt=function(){this.size=0,this.__data__={hash:new Bt,map:new(Kt||Jt),string:new Bt}};var Wt=function(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var Xt=function(t,r){var e=t.__data__;return Wt(r)?e["string"==typeof r?"string":"hash"]:e.map};var Zt=function(t){var r=Xt(this,t).delete(t);return this.size-=r?1:0,r};var tr=function(t){return Xt(this,t).get(t)};var rr=function(t){return Xt(this,t).has(t)};var er=function(t,r){var e=Xt(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};function nr(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}nr.prototype.clear=Qt,nr.prototype.delete=Zt,nr.prototype.get=tr,nr.prototype.has=rr,nr.prototype.set=er;var sr=nr,or="Expected a function";function ir(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError(or);var e=function(){var n=arguments,s=r?r.apply(this,n):n[0],o=e.cache;if(o.has(s))return o.get(s);var i=t.apply(this,n);return e.cache=o.set(s,i)||o,i};return e.cache=new(ir.Cache||sr),e}ir.Cache=sr;var ar=ir,ur=500;var cr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hr=/\\(\\)?/g,lr=function(t){var r=ar(t,(function(t){return e.size===ur&&e.clear(),t})),e=r.cache;return r}((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(cr,(function(t,e,n,s){r.push(n?s.replace(hr,"$1"):e||t)})),r}));var fr=function(t,r){for(var e=-1,n=null==t?0:t.length,s=Array(n);++e<n;)s[e]=r(t[e],e,t);return s},pr=1/0,dr=U?U.prototype:void 0,br=dr?dr.toString:void 0;var vr=function t(r){if("string"==typeof r)return r;if(N(r))return fr(r,t)+"";if(et(r))return br?br.call(r):"";var e=r+"";return"0"==e&&1/r==-pr?"-0":e};var yr=function(t){return null==t?"":vr(t)};var _r=function(t,r){return N(t)?t:ot(t,r)?[t]:lr(yr(t))},gr=1/0;var mr=function(t){if("string"==typeof t||et(t))return t;var r=t+"";return"0"==r&&1/t==-gr?"-0":r};var wr=function(t,r){for(var e=0,n=(r=_r(r,t)).length;null!=t&&e<n;)t=t[mr(r[e++])];return e&&e==n?t:void 0};var Sr=function(t,r,e){var n=null==t?void 0:wr(t,r);return void 0===n?e:n};const Er=Symbol("ABSENT"),xr=t=>t&&t!==Er,Pr=t=>t!==Er&&void 0!==t,jr=t=>t!==Er,kr=t=>t===Er,Or=new Map,$r=(t,r,e=!1)=>{if(r&&"function"==typeof r){if(Or.has(t)&&!e){if(Or.get(t)!==r)throw new Error(`cannot redefine ${t}`)}else Or.set(t,r);return $r}return Or.get(t)};$r("string",t=>"string"!=typeof t&&"value must be a string"),$r("number",t=>"number"!=typeof t&&"value must be a number"),$r("nan",t=>"number"==typeof t&&!Number.isNaN(t)&&"value must be not a number"),$r("integer",t=>!Number.isSafeInteger(t)&&"value must be an integer"),$r("array",t=>!Array.isArray(t)&&"value must be an array"),$r("object",t=>!(xr(t)&&"object"==typeof t&&!Array.isArray(t))&&"value must be an object"),$r("function",t=>"function"!=typeof t&&"value must be a function"),$r.is=(t,r=Er)=>kr(r)?r=>$r.is(t,r):!$r(t)(r);var Tr=function(){try{var t=jt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Ar=function(t,r,e){"__proto__"==r&&Tr?Tr(t,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[r]=e},Vr=Object.prototype.hasOwnProperty;var Mr=function(t,r,e){var n=t[r];Vr.call(t,r)&&Ht(n,e)&&(void 0!==e||r in t)||Ar(t,r,e)},zr=9007199254740991,Cr=/^(?:0|[1-9]\d*)$/;var Dr=function(t,r){var e=typeof t;return!!(r=null==r?zr:r)&&("number"==e||"symbol"!=e&&Cr.test(t))&&t>-1&&t%1==0&&t<r};var Nr=function(t,r,e,n){if(!it(t))return t;for(var s=-1,o=(r=_r(r,t)).length,i=o-1,a=t;null!=a&&++s<o;){var u=mr(r[s]),c=e;if(s!=i){var h=a[u];void 0===(c=n?n(h,u,a):void 0)&&(c=it(h)?h:Dr(r[s+1])?[]:{})}Mr(a,u,c),a=a[u]}return t};var Br=function(t,r,e){for(var n=-1,s=r.length,o={};++n<s;){var i=r[n],a=wr(t,i);e(a,i)&&Nr(o,_r(i,t),a)}return o};var qr=function(t,r){return null!=t&&r in Object(t)},Hr="[object Arguments]";var Fr=function(t){return tt(t)&&Z(t)==Hr},Ur=Object.prototype,Rr=Ur.hasOwnProperty,Yr=Ur.propertyIsEnumerable,Ir=Fr(function(){return arguments}())?Fr:function(t){return tt(t)&&Rr.call(t,"callee")&&!Yr.call(t,"callee")},Lr=9007199254740991;var Gr=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Lr};var Jr=function(t,r,e){for(var n=-1,s=(r=_r(r,t)).length,o=!1;++n<s;){var i=mr(r[n]);if(!(o=null!=t&&e(t,i)))break;t=t[i]}return o||++n!=s?o:!!(s=null==t?0:t.length)&&Gr(s)&&Dr(i,s)&&(N(t)||Ir(t))};var Kr=function(t,r){return null!=t&&Jr(t,r,qr)};var Qr=function(t,r){return Br(t,r,(function(r,e){return Kr(t,e)}))};var Wr=function(t,r){for(var e=-1,n=r.length,s=t.length;++e<n;)t[s+e]=r[e];return t},Xr=U?U.isConcatSpreadable:void 0;var Zr=function(t){return N(t)||Ir(t)||!!(Xr&&t&&t[Xr])};var te=function t(r,e,n,s,o){var i=-1,a=r.length;for(n||(n=Zr),o||(o=[]);++i<a;){var u=r[i];e>0&&n(u)?e>1?t(u,e-1,n,s,o):Wr(o,u):s||(o[o.length]=u)}return o};var re=function(t){return(null==t?0:t.length)?te(t,1):[]};var ee=function(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)},ne=Math.max;var se=function(t,r,e){return r=ne(void 0===r?t.length-1:r,0),function(){for(var n=arguments,s=-1,o=ne(n.length-r,0),i=Array(o);++s<o;)i[s]=n[r+s];s=-1;for(var a=Array(r+1);++s<r;)a[s]=n[s];return a[r]=e(i),ee(t,this,a)}};var oe=function(t){return function(){return t}},ie=Tr?function(t,r){return Tr(t,"toString",{configurable:!0,enumerable:!1,value:oe(r),writable:!0})}:D,ae=800,ue=16,ce=Date.now;var he=function(t){var r=0,e=0;return function(){var n=ce(),s=ue-(n-e);if(e=n,s>0){if(++r>=ae)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(ie);var le=function(t){return he(se(t,void 0,re),t+"")}((function(t,r){return null==t?{}:Qr(t,r)}));class fe{constructor(t,r=Er){this.value=t,Pr(r)&&("string"==typeof r.name&&(this.name=r.name),this.trans=!!r.trans,this.prev=r.prev,this.error=r.error,this.target=r.target,this.blocker=!!r.blocker,this.virtual=!!r.virtual)}get message(){return this.error?"string"==typeof this.error?this.error:"object"==typeof this.error&&this.error.error&&"string"==typeof this.error.error?this.error.error:"":""}toJSON(){const t=le(this,"target,name,value,complete,prev,trans,error".split(","));return t.message=this.message,"object"==typeof t.target&&t.target.name&&(t.target=t.target.name),this.blocker&&(t.blocker=!0),this.virtual&&(t.virtual=!0),t}}t.proppify(fe).addProp("target",null).addProp("name","").addProp("blocker",!1,"boolean").addProp("value",null).addProp("complete",!1).addProp("prev",Er).addProp("trans",!1,"boolean").addProp("virtual",!1,"boolean").addProp("error",null);var pe=1/0;var de=function(t){return(null==t?0:t.length)?te(t,pe):[]};function be(t,r="invalid ValueStream name"){if(!t||!Pr(t)||"string"!=typeof t&&"number"!=typeof t){const e=new Error(r);throw jr(t)?e.name=t:e.name=void 0,e}}const ve=/^!(.*)$/;class ye{constructor(t=Er,r=Er,e=Er){this.name=t,this._value=Er;try{this._setValue(r)}catch(t){this._value=Er}xr(e)&&(this.filter=e)}get name(){return this._name}set name(t){be(t,"cannot initialize ValueStream with bad name"),this._name=t}hasValidName(){try{return be(this.name),!0}catch(t){return!1}}get value(){if(this._value!==Er)return this._value}_setValue(t){let r=this.validate(t,!0);if(r){Array.isArray(r)&&(r=r.join(", "));const t=new Error(`attempt to set ${this.name} to bad value`);throw t.error=r,t}this._value=t}validate(t=Er,r=!1){try{if(kr(t)&&(t=this.value),kr(t))return r?null:[];if(!xr(this.filter)||kr(t))return!1;const e=de([this.filter]),n=this._validateList(e,t);return r?!!n.length&&(1===n.length?n.pop():n):n}catch(t){console.log("error validating type:",t)}return!1}_validateList(t,r){return t.reduce((t,e)=>{const n=this._validateFilter(e,r,t);return n?[...t,n]:t},[])}_validateFilter(t,r,e){if("function"==typeof t)return t(r,e,this);if("string"==typeof t){if(ve.test(t)){const n=ve.exec(t)[1];return!this._validateFilter(n,r,e)&&`${this.name} cannot be a ${n}`}const n=$r(t);if(!n)return`cannot parse type ${t}`;if(n(r))return`${this.name} must be a ${t}`}return!1}}t.proppify(ye).addProp("filter",Er);class _e extends ye{constructor(t=Er,r=Er,e=Er){super(t,r,e)}get $changes(){return this._changes||(this._changes=new x),this._changes}next(...t){let r=!1;try{r=this.makeMessage(...t),this.isComplete?r.error="Attempt to update a completed stream":this.$requests.next(r)}catch(t){(r=t).error=t.message}return r}nextPromise(...t){let r;try{r=this.next(...t)}catch(t){(r=t).error=t.message}return new Promise((t,e)=>{r.error?e(r):t(r)})}makeMessage(t=Er,r=Er){const e=xr(r)&&"object"==typeof r?r:{};return new fe(t,{...e,name:this.name,target:this})}get $requests(){return this.__requests||(this.__requests=new x,this.subSet.add(this.__requests.subscribe(this._onRequest.bind(this),t=>{console.log("request submission error:",t)}))),this.__requests}get _$blockers(){return this._blockers||(this._blockers=new Set),this._blockers}get hasBlockers(){return!!Sr(this,"parent.hasBlockers")||!!this._blockers&&this._$blockers.size>0}block(t=Er){return xr(t)||(t=this.makeMessage("blocker",{blocker:!0,target:this})),this._$blockers.add(t),t}unblock(t){t&&this.hasBlockers&&(this._$blockers.delete(t),this.parent&&this.parent.unblock&&this.parent.unblock(t))}_onRequest(t){if(this.hasBlockers)throw t.error=new Error("cannot execute requests on a blocked ValueStream"),this.errors.next(t),t;if(t.complete||kr(t.value))return t;t.prev=this.value,t.trans&&t.startTrans();try{this._setValue(t.value)}catch({message:r,error:e}){t.error=e||r,this.errors.next(t)}return t.error?(t.trans&&this.endTrans(t),t):(this.$changes.next(t),this.hasTranses?this.pendingChanges=!0:this._broadcastChange(t),t.trans&&this.endTrans(t),t)}_broadcastChange(t){this._$updater.next(t)}get errors(){var t,r;return this._errors||(this._errors=(new x).pipe((function(e){return e.lift(new V(t,r))}))),this._errors}flushTranses(){let t=[];return this._transes&&(t=Array.from(this._transes.values()),this._transes.clear()),t}get hasTranses(){return!!this._transes&&this._transes.size}get _$transes(){return this.hasTranses||(this._transes=new Set),this._transes}startTrans(t){return t||(t=this.makeMessage(Er,{trans:!0,target:this})),this._$transes.add(t),this._broadcastTrans(),t}endTrans(t){t&&(this.parent&&this.parent.endTrans&&this.parent.endTrans(t),this._$transes.has(t)&&(this._$transes.delete(t),this._broadcastTrans()))}_broadcastTrans(){this._$transStream.next(this._$transes.size)}get _$transStream(){return this.__transStream||(this.__transStream=new j(this._$transes.size),this.subSet.add(this.__transStream.pipe((function(t){return t.lift(new z)})).subscribe(([t,r])=>{this.pendingChanges&&t&&!r&&(this.pendingChanges=!1,this._broadcastChange())}))),this.__transStream}get _$updater(){return this.__updater||(this.__updater=new j(this)),this.__updater}subscribe(t=D,r=D,e=D){r&&this.subSet.add(this.errors.subscribe(r,r));const n=this._$updater.subscribe(()=>{t(this)},r,e);return this.subSet.add(n),n}get isComplete(){return!!this._completed}complete(){this._completed=!0;try{Array.from(this.subSet).forEach(t=>{t.unsubscribe(),this.subSet.delete(t)})}catch(t){console.log("complete error: ",t)}}}t.proppify(_e).addProp("pendingChanges",!1,"boolean").addProp("parent",null).addProp("subSet",()=>new Set);var ge=function(t,r,e){var n=-1,s=t.length;r<0&&(r=-r>s?0:s+r),(e=e>s?s:e)<0&&(e+=s),s=r>e?0:e-r>>>0,r>>>=0;for(var o=Array(s);++n<s;)o[n]=t[n+r];return o};var me=function(t,r,e){var n=t.length;return e=void 0===e?n:e,!r&&e>=n?t:ge(t,r,e)},we=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Se=function(t){return we.test(t)};var Ee=function(t){return t.split("")},xe="[\\ud800-\\udfff]",Pe="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",je="\\ud83c[\\udffb-\\udfff]",ke="[^\\ud800-\\udfff]",Oe="(?:\\ud83c[\\udde6-\\uddff]){2}",$e="[\\ud800-\\udbff][\\udc00-\\udfff]",Te="(?:"+Pe+"|"+je+")"+"?",Ae="[\\ufe0e\\ufe0f]?"+Te+("(?:\\u200d(?:"+[ke,Oe,$e].join("|")+")[\\ufe0e\\ufe0f]?"+Te+")*"),Ve="(?:"+[ke+Pe+"?",Pe,Oe,$e,xe].join("|")+")",Me=RegExp(je+"(?="+je+")|"+Ve+Ae,"g");var ze=function(t){return t.match(Me)||[]};var Ce=function(t){return Se(t)?ze(t):Ee(t)};var De=function(t){return function(r){r=yr(r);var e=Se(r)?Ce(r):void 0,n=e?e[0]:r.charAt(0),s=e?me(e,1).join(""):r.slice(1);return n[t]()+s}}("toUpperCase");const Ne="undefined"!=typeof Proxy;class Be extends _e{constructor(t,r=Er,e=Er,n=Er){super(t),$r.is("object",r)&&this._initValues(r),$r.is("object",e)&&this._initMethods(e),$r.is("object",n)&&this._initVirtuals(n),this.next(this.value)}_initVirtuals(t){Object.keys(t).forEach(r=>{const e=t[r];this.addVirtual(r,e)})}addVirtual(t,r,e=!1){if(!$r.is("function",r))throw new Error("non-function supplied as virtual value");if(!e&&this._$virtuals.has(t))throw new Error(`cannot redefine ${t}`);this._$virtuals.set(t,(...e)=>this.derive(r,t,...e))}_initMethods(t){Object.keys(t).forEach(r=>{const e=t[r];Array.isArray(e)?this.addMethod(r,...e):this.addMethod(r,e)})}_initValues(t){Object.keys(t).forEach(r=>{const e=t[r];Array.isArray(e)?this.addStream(r,...e):this.addStream(r,e)})}setFilter(t,r){return this.streams[t].filter=r,this}_updateStreamValue(t,r){this.streams.get(t).next(r)}get _$virtuals(){return this._virtuals||(this._virtuals=new Map),this._virtuals}get hasVirtuals(){return this._virtuals&&this._$virtuals.size}hasVirtual(t){return!!this.hasVirtuals&&this._$virtuals.has(t)}derive(t,r,...e){if(!$r.is("function",t))throw new Error("derive requires a function");const n=this.makeMessage({name:r,fn:t},{virtual:!0,blocker:!0}),s=this._getBlocker(r);if(s)throw n.error={error:"circular virtual",circular:s},n;this.block(n);const o=this._try(t,this,...e);return this.unblock(n),o}_getBlocker(t){let r=!1;return this.hasBlockers&&this._$blockers.forEach(e=>{!r&&e.virtual&&e.name===t&&(r=e)}),r}deriveAll(t=Er){const r=new Map;return this._$virtuals.forEach((e,n)=>{Array.isArray(t)&&!t.includes(n)||r.set(n,this._try(e,this))}),r}get value(){return this._genValue()}get my(){return Ne?(this._valueProxy||(this._valueProxy=this._genValueProxy()),this._valueProxy):this._genValue()}_genValueProxy(){const t=this;return new Proxy({},{get(r,e){if(t.streams.has(e)){return t.streams.get(e).value}if(t.hasVirtuals&&t._$virtuals.has(e))return t._$virtuals.get(e)()}})}_genValue(){const t={};if(this.streams.forEach(r=>{t[r.name]=r.value}),!this.hasBlockers){this.deriveAll().forEach((r,e)=>{try{t.hasOwnProperty(e)||(t[e]=r)}catch(t){console.error("cannot attach virtual - conflicts with existing stream",e)}})}return t}clearCache(){delete this._valueProxy,delete this._do,delete this._propSetters}property(...t){return this.addStream(...t)}subscribe(t,...r){return super.subscribe(()=>{t(this)},...r)}addStream(t,r=Er,e=Er){if(this.streams.has(t))throw new Error(`${this.name}: cannot redefine property ${t}`);const n=new _e(t,r,e);return n.parent=this,this.subSet.add(n.subscribe(()=>{this.next(this.value)},t=>{t instanceof fe&&(t=t.toJSON()),this.errors.next({store:this.name,source:n.name,error:t})})),this.streams.set(t,n),delete this._propSetters,this.clearCache(),this}method(...t){return this.addMethod(...t)}addMethod(t,r,e=Er){const n=Sr(e,"bind",!1),s=Sr(e,"trans",!1),o=Sr(e,"throws",!1);if(this.methods.has(t))throw new Error(`${this.name}: cannot redefine method ${t}`);const i=n?r.bind(this):(...t)=>r(this,...t);return o?this.methods.set(t,(...t)=>s?this.throwTrans(i,...t):this.throws(i,...t)):this.methods.set(t,(...t)=>s?this._tryTrans(i,...t):this.try(i,...t)),this.clearCache(),this}_tryTrans(t,...r){if(this.hasBlockers)throw new Error("cannot execute methods while blocked");const e=this.startTrans(),n=this.try(t,...r);return this.endTrans(e),n}try(t,...r){if(this.hasBlockers)throw new Error("cannot execute methods while blocked");return this._try(t,...r)}_try(t,...r){let e;try{e=t(...r)}catch(t){this.errors.next(t)}return e}throws(t,...r){if(this.hasBlockers)throw new Error("cannot execute methods while blocked");let e,n=!1,s=this.subscribe(()=>{},t=>{n=t});try{e=t(...r)}catch(t){s.unsubscribe(),s=null,t!==n&&(this.errors.next(t),n=t)}if(s&&s.unsubscribe(),n)throw n;return e}throwTrans(t,...r){if(this.hasBlockers)throw new Error("cannot execute methods while blocked");let e;const n=this.startTrans();let s=!1;try{e=this.throws(t,...r)}catch(t){s=t}if(this.endTrans(n),s)throw s;return e}get do(){return this._do||(this._do=Ne?this._genDoProxy():this._genDo()),this._do}get _$propSetters(){return this._propSetters||(this._propSetters={},this.streams.forEach(t=>{const r=`set${De(t.name)}`;this._propSetters[r]=r=>t.next(r);const e=`${r}_ot`;this._propSetters[e]=t=>this.throws(()=>this._propSetters[r](t))})),this._propSetters}_genDoProxy(){const t=this;return new Proxy({},{get:(r,e)=>t._$propSetters[e]?t._$propSetters[e]:t.methods.get(e)})}_genDo(){const t={...this._$propSetters};return this.methods.forEach((r,e)=>{t[e]=r}),t}}return t.proppify(Be).addProp("methods",()=>new Map).addProp("streams",()=>new Map),{ValueStream:_e,Value:ye,ValueStore:Be,ABSENT:Er,validators:$r}}));
