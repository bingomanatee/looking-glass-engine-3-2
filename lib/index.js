!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("@wonderlandlabs/validators"),require("@wonderlandlabs/propper")):"function"==typeof define&&define.amd?define(["@wonderlandlabs/validators","@wonderlandlabs/propper"],r):(t=t||self).LGE=r(t.validators,t.propper)}(this,(function(t,r){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(t,r)};function n(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function s(t){return"function"==typeof t}var i=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;i=t},get useDeprecatedSynchronousErrorHandling(){return i}};function u(t){setTimeout((function(){throw t}),0)}var c={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;u(t)},complete:function(){}},a=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function h(t){return null!==t&&"object"==typeof t}var p=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,r){return r+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),l=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var r;if(!this.closed){var e=this._parentOrParents,n=this._ctorUnsubscribe,i=this._unsubscribe,o=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof t)e.remove(this);else if(null!==e)for(var u=0;u<e.length;++u){e[u].remove(this)}if(s(i)){n&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){r=t instanceof p?f(t.errors):[t]}}if(a(o)){u=-1;for(var c=o.length;++u<c;){var l=o[u];if(h(l))try{l.unsubscribe()}catch(t){r=r||[],t instanceof p?r=r.concat(f(t.errors)):r.push(t)}}}if(r)throw new p(r)}},t.prototype.add=function(r){var e=r;if(!r)return t.EMPTY;switch(typeof r){case"function":e=new t(r);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof t)){var n=e;(e=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}var s=e._parentOrParents;if(null===s)e._parentOrParents=this;else if(s instanceof t){if(s===this)return e;e._parentOrParents=[s,this]}else{if(-1!==s.indexOf(this))return e;s.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[e]:i.push(e),e},t.prototype.remove=function(t){var r=this._subscriptions;if(r){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,r){return t.concat(r instanceof p?r.errors:r)}),[])}var d=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),b=function(t){function r(e,n,s){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=c;break;case 1:if(!e){i.destination=c;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(i)):(i.syncErrorThrowable=!0,i.destination=new _(i,e));break}default:i.syncErrorThrowable=!0,i.destination=new _(i,e,n,s)}return i}return n(r,t),r.prototype[d]=function(){return this},r.create=function(t,e,n){var s=new r(t,e,n);return s.syncErrorThrowable=!1,s},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},r}(l),_=function(t){function r(r,e,n,i){var o,u=t.call(this)||this;u._parentSubscriber=r;var a=u;return s(e)?o=e:e&&(o=e.next,n=e.error,i=e.complete,e!==c&&(s((a=Object.create(e)).unsubscribe)&&u.add(a.unsubscribe.bind(a)),a.unsubscribe=u.unsubscribe.bind(u))),u._context=a,u._next=o,u._error=n,u._complete=i,u}return n(r,t),r.prototype.next=function(t){if(!this.isStopped&&this._next){var r=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?this.__tryOrSetError(r,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},r.prototype.error=function(t){if(!this.isStopped){var r=this._parentSubscriber,e=o.useDeprecatedSynchronousErrorHandling;if(this._error)e&&r.syncErrorThrowable?(this.__tryOrSetError(r,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(r.syncErrorThrowable)e?(r.syncErrorValue=t,r.syncErrorThrown=!0):u(t),this.unsubscribe();else{if(this.unsubscribe(),e)throw t;u(t)}}},r.prototype.complete=function(){var t=this;if(!this.isStopped){var r=this._parentSubscriber;if(this._complete){var e=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?(this.__tryOrSetError(r,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},r.prototype.__tryOrUnsub=function(t,r){try{t.call(this._context,r)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;u(t)}},r.prototype.__tryOrSetError=function(t,r,e){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{r.call(this._context,e)}catch(r){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(u(r),!0)}return!1},r.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},r}(b);var y=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function v(t){return t}function m(t){return 0===t.length?v:1===t.length?t[0]:function(r){return t.reduce((function(t,r){return r(t)}),r)}}var w=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(t,r,e){var n=this.operator,s=function(t,r,e){if(t){if(t instanceof b)return t;if(t[d])return t[d]()}return t||r||e?new b(t,r,e):new b(c)}(t,r,e);if(n?s.add(n.call(s,this.source)):s.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),o.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),!function(t){for(;t;){var r=t,e=r.closed,n=r.destination,s=r.isStopped;if(e||s)return!1;t=n&&n instanceof b?n:null}return!0}(t)?console.warn(r):t.error(r)}},t.prototype.forEach=function(t,r){var e=this;return new(r=g(r))((function(r,n){var s;s=e.subscribe((function(r){try{t(r)}catch(t){n(t),s&&s.unsubscribe()}}),n,r)}))},t.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},t.prototype[y]=function(){return this},t.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 0===t.length?this:m(t)(this)},t.prototype.toPromise=function(t){var r=this;return new(t=g(t))((function(t,e){var n;r.subscribe((function(t){return n=t}),(function(t){return e(t)}),(function(){return t(n)}))}))},t.create=function(r){return new t(r)},t}();function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var S=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),x=function(t){function r(r,e){var n=t.call(this)||this;return n.subject=r,n.subscriber=e,n.closed=!1,n}return n(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,r=t.observers;if(this.subject=null,r&&0!==r.length&&!t.isStopped&&!t.closed){var e=r.indexOf(this.subscriber);-1!==e&&r.splice(e,1)}}},r}(l),E=function(t){function r(r){var e=t.call(this,r)||this;return e.destination=r,e}return n(r,t),r}(b),j=function(t){function r(){var r=t.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return n(r,t),r.prototype[d]=function(){return new E(this)},r.prototype.lift=function(t){var r=new P(this,this);return r.operator=t,r},r.prototype.next=function(t){if(this.closed)throw new S;if(!this.isStopped)for(var r=this.observers,e=r.length,n=r.slice(),s=0;s<e;s++)n[s].next(t)},r.prototype.error=function(t){if(this.closed)throw new S;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var r=this.observers,e=r.length,n=r.slice(),s=0;s<e;s++)n[s].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new S;this.isStopped=!0;for(var t=this.observers,r=t.length,e=t.slice(),n=0;n<r;n++)e[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(r){if(this.closed)throw new S;return t.prototype._trySubscribe.call(this,r)},r.prototype._subscribe=function(t){if(this.closed)throw new S;return this.hasError?(t.error(this.thrownError),l.EMPTY):this.isStopped?(t.complete(),l.EMPTY):(this.observers.push(t),new x(this,t))},r.prototype.asObservable=function(){var t=new w;return t.source=this,t},r.create=function(t,r){return new P(t,r)},r}(w),P=function(t){function r(r,e){var n=t.call(this)||this;return n.destination=r,n.source=e,n}return n(r,t),r.prototype.next=function(t){var r=this.destination;r&&r.next&&r.next(t)},r.prototype.error=function(t){var r=this.destination;r&&r.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):l.EMPTY},r}(j),k=function(t){function r(r){var e=t.call(this)||this;return e._value=r,e}return n(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(r){var e=t.prototype._subscribe.call(this,r);return e&&!e.closed&&r.next(this._value),e},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new S;return this._value},r.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},r}(j);function O(t){return t&&"function"==typeof t.schedule}var T=function(t){return function(r){for(var e=0,n=t.length;e<n&&!r.closed;e++)r.next(t[e]);r.complete()}};function V(t,r){return new w((function(e){var n=new l,s=0;return n.add(r.schedule((function(){s!==t.length?(e.next(t[s++]),e.closed||n.add(this.schedule())):e.complete()}))),n}))}function A(t,r){return r?V(t,r):new w(T(t))}function U(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=t[t.length-1];return O(e)?(t.pop(),V(t,e)):A(t)}function H(t,r){return function(e){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new D(t,r))}}var D=function(){function t(t,r){this.project=t,this.thisArg=r}return t.prototype.call=function(t,r){return r.subscribe(new N(t,this.project,this.thisArg))},t}(),N=function(t){function r(r,e,n){var s=t.call(this,r)||this;return s.project=e,s.count=0,s.thisArg=n||s,s}return n(r,t),r.prototype._next=function(t){var r;try{r=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(r)},r}(b),C=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.notifyNext=function(t,r,e,n,s){this.destination.next(r)},r.prototype.notifyError=function(t,r){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(b),z=function(t){function r(r,e,n){var s=t.call(this)||this;return s.parent=r,s.outerValue=e,s.outerIndex=n,s.index=0,s}return n(r,t),r.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},r.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(b);function M(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var R=M(),Y=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function q(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var B=function(t){if(t&&"function"==typeof t[y])return n=t,function(t){var r=n[y]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)};if(Y(t))return T(t);if(q(t))return e=t,function(t){return e.then((function(r){t.closed||(t.next(r),t.complete())}),(function(r){return t.error(r)})).then(null,u),t};if(t&&"function"==typeof t[R])return r=t,function(t){for(var e=r[R]();;){var n=void 0;try{n=e.next()}catch(r){return t.error(r),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof e.return&&t.add((function(){e.return&&e.return()})),t};var r,e,n,s=h(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function I(t,r,e,n,s){if(void 0===s&&(s=new z(t,e,n)),!s.closed)return r instanceof w?r.subscribe(s):B(r)(s)}var K={};function F(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=void 0,n=void 0;return O(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&a(t[0])&&(t=t[0]),A(t,n).lift(new G(e))}var G=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,r){return r.subscribe(new J(t,this.resultSelector))},t}(),J=function(t){function r(r,e){var n=t.call(this,r)||this;return n.resultSelector=e,n.active=0,n.values=[],n.observables=[],n}return n(r,t),r.prototype._next=function(t){this.values.push(K),this.observables.push(t)},r.prototype._complete=function(){var t=this.observables,r=t.length;if(0===r)this.destination.complete();else{this.active=r,this.toRespond=r;for(var e=0;e<r;e++){var n=t[e];this.add(I(this,n,void 0,e))}}},r.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(t,r,e){var n=this.values,s=n[e],i=this.toRespond?s===K?--this.toRespond:this.toRespond:0;n[e]=r,0===i&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))},r.prototype._tryResultSelector=function(t){var r;try{r=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(r)},r}(C);function L(t,r){if(null!=t){if(function(t){return t&&"function"==typeof t[y]}(t))return function(t,r){return new w((function(e){var n=new l;return n.add(r.schedule((function(){var s=t[y]();n.add(s.subscribe({next:function(t){n.add(r.schedule((function(){return e.next(t)})))},error:function(t){n.add(r.schedule((function(){return e.error(t)})))},complete:function(){n.add(r.schedule((function(){return e.complete()})))}}))}))),n}))}(t,r);if(q(t))return function(t,r){return new w((function(e){var n=new l;return n.add(r.schedule((function(){return t.then((function(t){n.add(r.schedule((function(){e.next(t),n.add(r.schedule((function(){return e.complete()})))})))}),(function(t){n.add(r.schedule((function(){return e.error(t)})))}))}))),n}))}(t,r);if(Y(t))return V(t,r);if(function(t){return t&&"function"==typeof t[R]}(t)||"string"==typeof t)return function(t,r){if(!t)throw new Error("Iterable cannot be null");return new w((function(e){var n,s=new l;return s.add((function(){n&&"function"==typeof n.return&&n.return()})),s.add(r.schedule((function(){n=t[R](),s.add(r.schedule((function(){if(!e.closed){var t,r;try{var s=n.next();t=s.value,r=s.done}catch(t){return void e.error(t)}r?e.complete():(e.next(t),this.schedule())}})))}))),s}))}(t,r)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}var $=function(t){function r(r){var e=t.call(this)||this;return e.parent=r,e}return n(r,t),r.prototype._next=function(t){this.parent.notifyNext(t)},r.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(b),Q=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.notifyNext=function(t){this.destination.next(t)},r.prototype.notifyError=function(t){this.destination.error(t)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(b);function W(t,r){if(!r.closed)return t instanceof w?t.subscribe(r):B(t)(r)}function X(t,r){return function(e){return e.lift(new Z(t,r))}}var Z=function(){function t(t,r){this.predicate=t,this.thisArg=r}return t.prototype.call=function(t,r){return r.subscribe(new tt(t,this.predicate,this.thisArg))},t}(),tt=function(t){function r(r,e,n){var s=t.call(this,r)||this;return s.predicate=e,s.thisArg=n,s.count=0,s}return n(r,t),r.prototype._next=function(t){var r;try{r=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}r&&this.destination.next(t)},r}(b);const rt=Symbol("ABSENT"),et=t=>t===rt,nt=t=>t,st=(new k(null),t()),it=st.is("function"),ot=st.is("array"),ut=st.is("object"),ct=st.is("string"),at=st.is("number");st.is("map"),st.is("set");function ht(t){return function(r){var e=new pt(t),n=r.lift(e);return e.caught=n}}var pt=function(){function t(t){this.selector=t}return t.prototype.call=function(t,r){return r.subscribe(new lt(t,this.selector,this.caught))},t}(),lt=function(t){function r(r,e,n){var s=t.call(this,r)||this;return s.selector=e,s.caught=n,s}return n(r,t),r.prototype.error=function(r){if(!this.isStopped){var e=void 0;try{e=this.selector(r,this.caught)}catch(r){return void t.prototype.error.call(this,r)}this._unsubscribeAndRecycle();var n=new $(this);this.add(n);var s=W(e,n);s!==n&&this.add(s)}},r}(Q);function ft(t,r){return function(e){return e.lift(new dt(t,r))}}var dt=function(){function t(t,r){this.compare=t,this.keySelector=r}return t.prototype.call=function(t,r){return r.subscribe(new bt(t,this.compare,this.keySelector))},t}(),bt=function(t){function r(r,e,n){var s=t.call(this,r)||this;return s.keySelector=n,s.hasKey=!1,"function"==typeof e&&(s.compare=e),s}return n(r,t),r.prototype.compare=function(t,r){return t===r},r.prototype._next=function(t){var r;try{var e=this.keySelector;r=e?e(t):t}catch(t){return this.destination.error(t)}var n=!1;if(this.hasKey)try{n=(0,this.compare)(this.key,r)}catch(t){return this.destination.error(t)}else this.hasKey=!0;n||(this.key=r,this.destination.next(t))},r}(b);function _t(t,r){return"function"==typeof r?function(e){return e.pipe(_t((function(e,n){return(s=t(e,n),i?L(s,i):s instanceof w?s:new w(B(s))).pipe(H((function(t,s){return r(e,t,n,s)})));var s,i})))}:function(r){return r.lift(new yt(t))}}var yt=function(){function t(t){this.project=t}return t.prototype.call=function(t,r){return r.subscribe(new vt(t,this.project))},t}(),vt=function(t){function r(r,e){var n=t.call(this,r)||this;return n.project=e,n.index=0,n}return n(r,t),r.prototype._next=function(t){var r,e=this.index++;try{r=this.project(t,e)}catch(t){return void this.destination.error(t)}this._innerSub(r)},r.prototype._innerSub=function(t){var r=this.innerSubscription;r&&r.unsubscribe();var e=new $(this),n=this.destination;n.add(e),this.innerSubscription=W(t,e),this.innerSubscription!==e&&n.add(this.innerSubscription)},r.prototype._complete=function(){var r=this.innerSubscription;r&&!r.closed||t.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},r.prototype.notifyNext=function(t){this.destination.next(t)},r}(Q),mt=t=>ot(t)?t.reduce((t,r)=>t.includes(r)?t:[...t,r],[]):[];var wt=t=>{do{t=t.reduce((t,r)=>ot(r)?[...t,...r]:[...t,r],[])}while(t.some(ot));return t};class gt{constructor(t,r){this.value=t.value,this.stream=t,this.next=r}toJSON(){return{name:this.stream.name,value:this.value,next:this.next,nextValue:this.nextValue,errors:this.errors,notes:this.notes,thrown:this.thrown}}pre(){try{const t=this.stream.getPre(this.next);this.nextValue=t}catch(t){this.thrown.push({at:"pre",error:t})}}post(){try{const{errors:t,notes:r}=this.stream.getPost(this.next);ot(t)&&(this.errors=mt([...this.errors,...t]).filter(nt)),this.notes=r}catch(t){this.thrown.push({at:"post",error:t})}}}function St(t,r){return ut(t)?wt(r).reduce((r,e)=>(r[e]=t[e],r),{}):{}}r.proppify(gt).addProp("stream").addProp("value").addProp("virtual",!1).addProp("virtualSubjects",[],"array").addProp("next").addProp("nextValue",rt).addProp("errors",()=>[],"array").addProp("thrown",()=>[],"array").addProp("notes");class xt{constructor(t,r,e=null,n=null,s=null,i=null){if(this._value=e,this.store=t,this.name=r,ut(n)){const{pre:t,post:r,comparator:e}=n;this._pre=t,this._post=r,this._comparator=e}else this._pre=n,this._post=s,this._comparator=i;this._initSubject(e),this._initChangeSubject(e),this._initialized=!0}_initSubject(t){this._subject=new k(t).pipe(ft((...t)=>this._compare(...t))),this._subject.subscribe(t=>{this._value=t})}reset(){this.errors=[],this.thrown=[],this.notes=null}_initChangeSubject(t){this._changeSubject=new k(t).pipe(_t(t=>U(t).pipe(H(t=>{const r=new gt(this,t);return r.pre(),r}),ht(()=>U(rt)))),_t(t=>U(t).pipe(H(t=>(t.post(),t)),ht(()=>U(rt)))),X(t=>!et(t))),this._changeSubject.subscribe(t=>{t.thrown.length||this._subject.next(t.nextValue)})}get changeSubject(){return this._changeSubject}pre(t){this._pre=t,this._initialized&&this.force()}post(t){this._post=t,this._initialized&&this.force()}force(){this.__forceUpdate=!0,this.next(this.value)}_compare(t,r){return!this.__forceUpdate&&!1!==this._comparator&&(it(this._comparator)?this._comparator(t,r):t===r)}comparator(t){return this._comparator=t,this}get __forceUpate(){const t=!!this.___forceUpdate;return this.___forceUpdate=!1,t}set __forceUpdate(t){this.___forceUpdate=!!t}get subject(){return this._subject}subscribe(...t){this.subject.subscribe(...t)}accepts(t){try{return this.getPost(t),!0}catch(t){return!1}}next(t){this.virtual?this._changeSubject.next(St(this.store.my,this.virtualSubjects)):this.changeSubject.next(t)}complete(){this._subject.complete(),this._changeSubject&&this._changeSubject.complete()}get value(){return this._value}getPre(t){return it(this._pre)?this._pre(t,this,this.store):t}getPost(t){const r={errors:[],notes:null};if(it(this._post)){const e=this._post(t);e&&ut(e)&&(ot(e)?r.errors=e:Object.assign(r,e))}return r}get meta(){return{value:this.value,errors:[...this.errors],notes:this.notes,hasErrors:this.errors.length}}}r.proppify(xt).addProp("errors",()=>[],"array").addProp("thrown",()=>[],"array").addProp("_comparator",null).addProp("type","","string").addProp("notes",null);class Et{constructor(t){this.subjectBlock=t}add(t){this._pending.add(t)}get _pending(){return this.__pending||(this.__pending=new Set),this.__pending}complete(){this.__pending&&this._pending.forEach(()=>{}),this.subjectBlock.blockDone(this)}}class jt{block(){const t=new Et(this);return this.blocks.add(t),this.update(),t}blockDone(t){this.blocks.delete(t),this.update()}do(t){const r=this.block(),e=[];try{e[1]=t()}catch(t){e[0]=t}return r.done(),e}update(){this.subject.next(this.blocks.size)}}r.proppify(jt).addProp("subject",()=>new k(0).pipe(ft())).addProp("blocks",()=>new Set);const Pt=/^[a-z][\w]+$/;function kt(t){return ct(t)&&Pt.test(t)}class Ot{constructor(t={},r={},e={}){this.subject.subscribe(nt,nt,()=>this._closeSets()),this.addStreams(t),this.addActions(r),this.addVirtuals(e),this._listenForChange(),this._initialized=!0,this.broadcast()}get _subject(){return this.__subject||(this.__subject=new k(this.value)),this.__subject}get virtualStreams(){const t=[];return this.streams.forEach(r=>{r.virtual&&t.push(r)}),t}_listenForChange(){F(this._blockStream,this._changeSubject).pipe(X(([t,r])=>!t&&(!r.thrown||!r.thrown.length)),H((t,r)=>r)).subscribe(t=>this.broadcast(t))}broadcast(t){let r=null;t&&t.thrown&&t.thrown.length||(this.virtualStreams.forEach(e=>{e.virtualSubjects.includes(t.name)&&(r||(r=this._block.block()),r.add(()=>e.next()))}),r&&r.complete(),this.subject.next(this.value))}_validStreamNames(t){return mt(wt(t)).filter(t=>t&&ct(t)&&this.streams.has(t))}select(...t){const r=this._validStreamNames(t);if(!r.length)throw new Error("select requires at least one method");const e=F(...r.map(t=>this.streams.get(t).subject)).pipe(H(t=>{const e={};return r.forEach(r=>{e[r]=t[r]}),e}));return this.subject.subscribe(nt,nt,()=>{e.complete()}),F(this._blockStream,e).pipe(X(([t])=>!t),H(([t,r])=>r))}selectChanges(...t){const r=this._validStreamNames(t);if(!r.length)throw new Error("select requires at least one method");return this.changeSubject.pipe(X(t=>r.includes(t.name)))}get propNames(){return Array.from(this.streams.keys())}pre(t,r){return ot(t)?t.forEach(t=>this.pre(t,r)):this.streams.has(t)?this.streams.get(t).pre(r):console.log("attempt to assign pre function ",r,"to unknown stream ",t),this}post(t,r){return ot(t)?t.forEach(t=>this.post(t,r)):this.streams.has(t)?this.streams.get(t).post(r):console.log("attempt to assign pre function ",r,"to unknown stream ",t),this}addVirtuals(t){Object.keys(t).forEach(r=>{this.virtual(r,...wt([t[r]]))})}addActions(t){return Object.keys(t).forEach(r=>{this.action(r,t[r])}),this._initialized&&this._redo(),this}action(t,r){if(!kt(t))throw new Error("cannot define action with name "+t);if(this._actions[t])throw new Error("cannot redefine action "+t);return this._actions[t]=(...t)=>r(this,...t),this._initialized&&this._redo(),this}method(...t){return this.action(...t)}addStreams(t){Object.keys(t).forEach(r=>{const e=t[r];ot(e)&&e.length>1&&it(e[1])?this._makeStream(r,...e):this._makeStream(r,e)}),this._updateStream()}virtual(t,r,...e){if(!kt(t))throw new Error("cannot make virtual: bad name: "+t);if(this.subjects.has(t))throw new Error("cannot redefine stream with virtual: "+t);const n=this._validStreamNames(e),s=this.makeStream(t,St(this.value,n),r);return s.virtual=!0,s.virtualSubjects=n,this}_closeSets(){this.subSets.forEach(t=>t.unsubscribe()),this.subSets.clear()}get _doValue(){return{...this._actions,...this._doSetters}}_redo(){this._doSetters={},this.streams.forEach((t,r)=>{if(t.virtual)return;const e="set"+(ct(n=r)?n.substr(0,1).toUpperCase()+n.substr(1):"");var n;this._doSetters[e]=r=>{try{if(t.virtual)return!1;t.next(r);const{meta:e}=t;return!(!e||!e.length)&&e}catch(e){throw Object.assign(e,{value:r,meta:t.getMeta(r)})}}})}get _doHandler(){return{get(t,r){if(t._doSetters[r])return t._doSetters[r];if(t._actions[r])return t._actions[r];throw Object.assign(new Error("attempt to call undefined action "+r),{store:t})}}}get _doProxy(){return this.__doProxy||("undefined"!=typeof Proxy?this.__doProxy=new Proxy(this,this._doHandler):this.__doProxy=rt),!et(this.__doProxy)&&this.__doProxy}get do(){return this._doProxy?this._doProxy:{...this._actions,...this._doSetters}}get _myHandler(){return{get(t,r){if(t.streams.has(r))return t.streams.get(r).value;if(t._virtuals.has(r))return t._virtuals.get(r).value;throw Object.assign(new Error("attempt to call undefined prop "+r),{store:t})}}}get _myProxy(){return this.__myProxy||("undefined"!=typeof Proxy?this.__myProxy=new Proxy(this,this._myHandler):this.__myProxy=rt),!et(this.__myProxy)&&this.__myProxy}get my(){return this._myProxy?this._myProxy:this.value}get value(){const t={};return this.streams.forEach((r,e)=>{t[e]=r.value}),t}get metaValue(){const t={};return this.streams.forEach((r,e)=>t[e]=r.meta),this._virtuals.forEach((r,e)=>t[e]=r.meta),t}values(...t){return mt(wt(t)).reduce((t,r)=>(this.streams.has(r)&&(t[r]=this.streams.get(r).value),this._virtuals.has(r)&&(t[r]=this._virtuals.get(r).value),t),{})}get subject(){return this._subject}get metaSubject(){return this.subject.pipe(H(()=>this.metaValues))}subscribe(...t){const r=this.subject.subscribe(...t);return this.subSets.add(r),r}_canUpdate(t){Object.keys(t).forEach(r=>{if(this.streams.has(r)){const e=t[r];if(!this.streams.get(r).accepts(e))throw Object.assign(new Error(r+" cannot accept this value"),{name:r,value:e,source:t})}else console.log("attempt to update absent name "+r)})}next(t){if(!t||!ut(t))throw new Error("next requires object");const[r]=this.block(()=>{this._canUpdate(t),Object.keys(t).forEach(r=>{this.streams.has(r)&&this.stream.next(t[r])})});if(r)throw r}get subjectValue(){return this._subjectValue||(this._subjectValue=this.subject.pipe(H(()=>this.value))),this._subjectValue}subscribeValue(...t){const r=this.subjectValue.subscribe(...t);return this.subSets.add(r),r}complete(){this.subject.complete(),this.streams.forEach(t=>{t.complete()}),this._closeSets()}_makeStream(t,r,e,n,s){if(this.__propsToValue=null,function(t,r="invalid property name"){if(!t||!ct(t)||at(t)){const e=new Error(r);throw e.name=t,e.absent=et(t),e}}(t),this.streams.has(t))throw new Error("cannot redefine "+t);const i=new xt(this,t,r,e,n,s),o=i.changeSubject.subscribe(t=>this._changeSubject.next(t),nt,()=>o.unsubscribe());this.streams.set(t,i)}get props(){return this._propProxy?this._propProxy:this._streamsAsObject()}get _propProxy(){this.__propProxy||("undefined"!=typeof Proxy?this.__propProxy=new Proxy(this,{get:(t,r)=>t.streams.get(r)}):this.__propProxy=rt);return!et(this.__propProxy)&&this.__propProxy}_streamsAsObject(){return this.__propsToValue||(this.__propsToValue={},this.streams.forEach((t,r)=>{this.__propsToValue[kt(r)]=t})),this.__propsToValue}stream(t,r,e,n,s){return this.makeStream(t,r,e,n,s),this}makeStream(t,r,e,n,s){return this._makeStream(t,r,e,n,s),this._updateStream(),this.streams.get(t)}property(...t){return this.stream(...t)}get _block(){return this.__block||(this.__block=new jt,this.__block.subject.subscribe(t=>{this.__block.next(t)})),this.__block}block(t){return this._block.do(t)}get changeSubject(){return this._changeSubject}_updateStream(){this._redo(),this.broadcast()}}return r.proppify(Ot).addProp("subSets",()=>new Set).addProp("_actions",()=>({})).addProp("streams",()=>new Map).addProp("_blockStream",()=>new k(0).pipe(ft())).addProp("_changeSubject",()=>new j),{validators:st,Stream:xt,ValueStore:Ot,ABSENT:rt,SubjectBlock:jt}}));
