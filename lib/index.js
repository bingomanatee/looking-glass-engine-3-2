!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@wonderlandlabs/validators"),require("@wonderlandlabs/propper")):"function"==typeof define&&define.amd?define(["@wonderlandlabs/validators","@wonderlandlabs/propper"],e):(t=t||self).LGE=e(t.validators,t.propper)}(this,(function(t,e){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function s(t,e){function s(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}function n(t){return"function"==typeof t}var i=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;i=t},get useDeprecatedSynchronousErrorHandling(){return i}};function u(t){setTimeout((function(){throw t}),0)}var c={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;u(t)},complete:function(){}},a=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function h(t){return null!==t&&"object"==typeof t}var p=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),l=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r=this._parentOrParents,s=this._ctorUnsubscribe,i=this._unsubscribe,o=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var u=0;u<r.length;++u){r[u].remove(this)}if(n(i)){s&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof p?f(t.errors):[t]}}if(a(o)){u=-1;for(var c=o.length;++u<c;){var l=o[u];if(h(l))try{l.unsubscribe()}catch(t){e=e||[],t instanceof p?e=e.concat(f(t.errors)):e.push(t)}}}if(e)throw new p(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var s=r;(r=new t)._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var n=r._parentOrParents;if(null===n)r._parentOrParents=this;else if(n instanceof t){if(n===this)return r;r._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return r;n.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,e){return t.concat(e instanceof p?e.errors:e)}),[])}var b=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),d=function(t){function e(r,s,n){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=c;break;case 1:if(!r){i.destination=c;break}if("object"==typeof r){r instanceof e?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new y(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new y(i,r,s,n)}return i}return s(e,t),e.prototype[b]=function(){return this},e.create=function(t,r,s){var n=new e(t,r,s);return n.syncErrorThrowable=!1,n},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(l),y=function(t){function e(e,r,s,i){var o,u=t.call(this)||this;u._parentSubscriber=e;var a=u;return n(r)?o=r:r&&(o=r.next,s=r.error,i=r.complete,r!==c&&(n((a=Object.create(r)).unsubscribe)&&u.add(a.unsubscribe.bind(a)),a.unsubscribe=u.unsubscribe.bind(u))),u._context=a,u._next=o,u._error=s,u._complete=i,u}return s(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):u(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;u(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;u(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(u(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(d);var _=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function m(t){return t}function v(t){return 0===t.length?m:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var w=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var s=this.operator,n=function(t,e,r){if(t){if(t instanceof d)return t;if(t[b])return t[b]()}return t||e||r?new d(t,e,r):new d(c)}(t,e,r);if(s?n.add(s.call(n,this.source)):n.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!n.syncErrorThrowable?this._subscribe(n):this._trySubscribe(n)),o.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable&&(n.syncErrorThrowable=!1,n.syncErrorThrown))throw n.syncErrorValue;return n},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,s=e.destination,n=e.isStopped;if(r||n)return!1;t=s&&s instanceof d?s:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=g(e))((function(e,s){var n;n=r.subscribe((function(e){try{t(e)}catch(t){s(t),n&&n.unsubscribe()}}),s,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[_]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:v(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=g(t))((function(t,r){var s;e.subscribe((function(t){return s=t}),(function(t){return r(t)}),(function(){return t(s)}))}))},t.create=function(e){return new t(e)},t}();function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var S=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),E=function(t){function e(e,r){var s=t.call(this)||this;return s.subject=e,s.subscriber=r,s.closed=!1,s}return s(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},e}(l),x=function(t){function e(e){var r=t.call(this,e)||this;return r.destination=e,r}return s(e,t),e}(d),j=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return s(e,t),e.prototype[b]=function(){return new x(this)},e.prototype.lift=function(t){var e=new P(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new S;if(!this.isStopped)for(var e=this.observers,r=e.length,s=e.slice(),n=0;n<r;n++)s[n].next(t)},e.prototype.error=function(t){if(this.closed)throw new S;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,s=e.slice(),n=0;n<r;n++)s[n].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new S;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),s=0;s<e;s++)r[s].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new S;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new S;return this.hasError?(t.error(this.thrownError),l.EMPTY):this.isStopped?(t.complete(),l.EMPTY):(this.observers.push(t),new E(this,t))},e.prototype.asObservable=function(){var t=new w;return t.source=this,t},e.create=function(t,e){return new P(t,e)},e}(w),P=function(t){function e(e,r){var s=t.call(this)||this;return s.destination=e,s.source=r,s}return s(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):l.EMPTY},e}(j),O=function(t){function e(e){var r=t.call(this)||this;return r._value=e,r}return s(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var r=t.prototype._subscribe.call(this,e);return r&&!r.closed&&e.next(this._value),r},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new S;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(j);function k(t){return t&&"function"==typeof t.schedule}var T=function(t){return function(e){for(var r=0,s=t.length;r<s&&!e.closed;r++)e.next(t[r]);e.complete()}};function M(t,e){return e?function(t,e){return new w((function(r){var s=new l,n=0;return s.add(e.schedule((function(){n!==t.length?(r.next(t[n++]),r.closed||s.add(this.schedule())):r.complete()}))),s}))}(t,e):new w(T(t))}function V(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new A(t,e))}}var A=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new D(t,this.project,this.thisArg))},t}(),D=function(t){function e(e,r,s){var n=t.call(this,e)||this;return n.project=r,n.count=0,n.thisArg=s||n,n}return s(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(d),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.notifyNext=function(t,e,r,s,n){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(d),N=function(t){function e(e,r,s){var n=t.call(this)||this;return n.parent=e,n.outerValue=r,n.outerIndex=s,n.index=0,n}return s(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(d);function F(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var U=F();var K=function(t){if(t&&"function"==typeof t[_])return n=t,function(t){var e=n[_]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if((s=t)&&"number"==typeof s.length&&"function"!=typeof s)return T(t);if(function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,u),t};if(t&&"function"==typeof t[U])return e=t,function(t){for(var r=e[U]();;){var s=void 0;try{s=r.next()}catch(e){return t.error(e),t}if(s.done){t.complete();break}if(t.next(s.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,s,n,i=h(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function L(t,e,r,s,n){if(void 0===n&&(n=new N(t,r,s)),!n.closed)return e instanceof w?e.subscribe(n):K(e)(n)}var R={};function B(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=void 0,s=void 0;return k(t[t.length-1])&&(s=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&a(t[0])&&(t=t[0]),M(t,s).lift(new Y(r))}var Y=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new C(t,this.resultSelector))},t}(),C=function(t){function e(e,r){var s=t.call(this,e)||this;return s.resultSelector=r,s.active=0,s.values=[],s.observables=[],s}return s(e,t),e.prototype._next=function(t){this.values.push(R),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var s=t[r];this.add(L(this,s,void 0,r))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,r){var s=this.values,n=s[r],i=this.toRespond?n===R?--this.toRespond:this.toRespond:0;s[r]=e,0===i&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(H);const z=Symbol("ABSENT"),I=t=>t===z,q=t=>t,G=new O(null),W=t(),X=W.is("function"),J=W.is("array"),Q=W.is("object"),Z=W.is("string"),$=W.is("number"),tt=W.is("map"),et=W.is("set");function rt(t,e){return function(r){return r.lift(new st(t,e))}}var st=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new nt(t,this.compare,this.keySelector))},t}(),nt=function(t){function e(e,r,s){var n=t.call(this,e)||this;return n.keySelector=s,n.hasKey=!1,"function"==typeof r&&(n.compare=r),n}return s(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var r=this.keySelector;e=r?r(t):t}catch(t){return this.destination.error(t)}var s=!1;if(this.hasKey)try{s=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;s||(this.key=e,this.destination.next(t))},e}(d);var it=t=>{do{t=t.reduce((t,e)=>J(e)?[...t,...e]:[...t,e],[])}while(t.some(J));return t};class ot{constructor(t,e,r=z){if(this.test=Z(t)?W(t):t,Z(e))this.name=e;else if(Q(e)){const{name:t="",order:r=1,config:s}=e;this.name=t,this.order=r,this.config=s}I(r)||(this.order=r)}process(t,e){const r=this.test(t,e,this.config);return r?Z(r)?{message:r,name:this.name}:r:null}}ot.isFilter=t=>t instanceof ot,ot.goodFilter=t=>t&&(X(t)||Z(t)&&W.has(t)||ot.isFilter(t)),ot.create=t=>{if(ot.isFilter(t))return t;let e,r="";return X(t)?(r=t.name||"",e=t):Z(t)&&W.has(t)&&(e=W(t),r=t),new ot(e,{name:r})},e.proppify(ot).addProp("name","","string").addProp("config",null).addProp("order",1).addProp("test",()=>!1,"function");const ut=new Map;class ct{constructor(...t){this._initMeta(t),this.annotate=this.annotate.bind(this),this.orderMetas=this.orderMetas.bind(this)}add(t){this.metas.push(ot.create(t))}get type(){return this.metas.length&&this.metas[0].name||""}_initMeta(t){this.metas=it(t).filter(ot.goodFilter).map(ot.create)}get _sig(){return this.metas.reduce((t,e)=>[...t,e.name,e.order],[]).join(",")}_indexOf(t){return this.orderKeys.includes(t)?this.orderKeys.indexOf(t):Number.MAX_SAFE_INTEGER}get _metaKeys(){return this.metas.map(this._keyFor).sort((t,e)=>{const r=this._indexOf(t),s=this._indexOf(e);return(r-s)/Math.abs(r-s)}).reduce((t,e)=>t.includes(e)?t:[...t,e],[])}_keyFor(t){return t?t.order:null}orderMetas(){if(!this.metas.length)return ut;if(this._cached&&this._cacheSig===this._sig)return this._cached;const t=this._metaKeys,e=new Map;return t.forEach(t=>e.set(t,[])),this.metas.forEach(t=>e.get(this._keyFor(t)).push(t)),this._cached=e,this._cacheSig=this._sig,e}annotate(t,e){const r=this.orderMetas(),s=[];t:for(const n of r.keys()){const i=r.get(n);if(s.length)break;for(const r of i){const i=r.process(t,s,e);if(Q(i)){const{stop:t,message:e}=i;if(e&&s.push({...i,level:n,meta:r.name||r.test}),t)break t}else i&&s.push({level:n,meta:r.name||r.test,message:i})}}return s}}e.proppify(ct).addProp("orderKeys",()=>["required","type",0,1,2],"array").addProp("metas",()=>[],"array");const at={array:t=>t&&J(t)?[...t]:[],object:t=>t&&Q(t)?{...t}:{},number:t=>$(t)?t:0,map:t=>tt(t)?new Map(t):new Map,set:t=>et(t)?new Set(t):new Set,function:t=>X(t)?t:q};class ht{constructor(t=null,e){this._initBase(t),this._initMeta(t,e),this._initSubject()}get meta(){return this._metaList.annotate(this.value)}preProcess(t){const e=t||this._metaList.type;return this._prep=!1,e&&(Z(e)?this._prep=at[e]:X(e)&&(this._prep=e)),this}_initMeta(t,e){this._metaList=new ct(e),this.lastValid=this._metaList.annotate(t,this).length?void 0:t}_initSubject(){this._subject=this._base.pipe(V(t=>{const e=this._metaList.annotate(t,this);return e.length||(this.lastValid=t),{value:t,meta:e,lastValid:this.lastValid}}))}_initBase(t){this.value=t,this._base=new O(t).pipe(rt()),this._base.subscribe(t=>{this.value=t})}addMeta(t,e="",r=1){this._metaList.add(new ot(t,e,r))}get subject(){return this._subject}subscribe(...t){this._subject.subscribe(...t)}next(t){this._prep?this._base.next(this._prep(t)):this._base.next(t)}complete(){this._base.complete()}}var pt={break:!0,continue:!0,delete:!0,else:!0,for:!0,function:!0,if:!0,in:!0,new:!0,return:!0,this:!0,typeof:!0,var:!0,void:!0,while:!0,with:!0,case:!0,catch:!0,default:!0,do:!0,finally:!0,instanceof:!0,switch:!0,throw:!0,try:!0},lt={await:!0,debugger:!0,class:!0,enum:!0,extends:!0,super:!0,const:!0,export:!0,import:!0,null:!0,true:!0,false:!0,implements:!0,let:!0,private:!0,public:!0,yield:!0,interface:!0,package:!0,protected:!0,static:!0};var ft=function(t,e){e&&(t+=" "+function(t){let e=0;for(let r=0;r<t.length;++r){e=(e<<5)-e+t.charCodeAt(r),e|=0}return e}(t).toString(36));const r=t.trim().replace(/\W+/g,"_");return pt[r]||lt[r]||/^\d/.test(r)?"_"+r:r};class bt{constructor(t,e,...r){this.store=t,this.fn=e,this.fields=it(r)}get value(){return this.fn(this.store.values(this.fields),this.store)}_makeSubject(){const t=new O(this.value);return this.store.subscribe(()=>t.next(this.value)),t.pipe(rt())}get subject(){return this._subject||(this._subject=this._makeSubject()),this._subject}}const dt=t=>J(t)?t.reduce((t,e)=>t.includes(e)?t:[...t,e],[]):[];class yt{constructor(t={},e={},r={}){this._subject=new O({}),this._subject.subscribe(q,q,()=>this._closeSets()),this._init(t),this._initActions(e),this._initVirtuals(r)}select(...t){const e=dt(it(t)),r=B(e.map(t=>this.streams.has(t)?this.streams.get(t).subject:this._virtuals.has(t)?this._virtuals.get(t).subject:G)).pipe(rt(),V(t=>e.reduce((e,r,s)=>(e[r]=t[s],e),{})));return this.subject.subscribe(q,q,()=>r.complete()),r}get propertyNames(){return Array.from(this.streams.keys())}preProcess(t,e){if(!t)return this.propertyNames.forEach(t=>this.preProcess(t)),this;if(X(t)&&(e=t,t=this.propertyNames.pop()),!this.streams.has(t))throw new Error("preProcess cannot find property "+t);return this.streams.get(t).preProcess(e),this}selectValues(...t){const e=dt(it(t)),r=[],s=B(e.map(t=>this.streams.has(t)?this.streams.get(t).subject:(this._virtuals.has(t)&&r.push(t),G))).pipe(rt(),V(t=>e.reduce((e,s,n)=>(e[s]=r.includes(s)?this._virtuals.get(s).value:t[n].value,e),{})));return this.subject.subscribe(q,q,()=>s.complete()),s}_initVirtuals(t){Object.keys(t).forEach(e=>{this.virtual(e,...it(t[e]))})}_initActions(t){return Object.keys(t).forEach(e=>{this.action(e,t[e])}),this}action(t,e){const r=ft(t);if(this._actions[r])throw new Error("cannot redefine action "+r);this._actions[r]=(...t)=>e(this,...t)}_init(t){this._relay&&this._relay.unsubscribe(),Object.keys(t).forEach(e=>{const r=t[e];J(r)?this.property(e,...r):this.property(e,r)}),this._updateStream(),this._initialized=!0}virtual(t,e,...r){const s=ft(t);if(this._virtuals.has(s))throw new Error("cannot redefine "+s);return this._virtuals.set(s,new bt(this,e,r)),this}_closeSets(){this.subSets.forEach(t=>t.unsubscribe()),this.subSets.clear()}get _doValue(){return{...this._actions,...this._doSetters}}_initDo(){this._doSetters={},this.streams.forEach((t,e)=>{const r="set"+(s=ft(e),Z(s)?s.substr(0,1).toUpperCase()+s.substr(1):"");var s;this._doSetters[r]=e=>{t.next(e);const{meta:r}=t;return!!r.length&&r}})}get _doHandler(){return{get(t,e){if(t._doSetters[e])return t._doSetters[e];if(t._actions[e])return t._actions[e];throw Object.assign(new Error("attempt to call undefined action "+e),{store:t})}}}get _doProxy(){return this.__doProxy||("undefined"!=typeof Proxy?this.__doProxy=new Proxy(this,this._doHandler):this.__doProxy=z),!I(this.__doProxy)&&this.__doProxy}get _myHandler(){return{get(t,e){if(t.streams.has(e))return t.streams.get(e).value;if(t._virtuals.has(e))return t._virtuals.get(e).value;throw Object.assign(new Error("attempt to call undefined property "+e),{store:t})}}}get _myProxy(){return this.__myProxy||("undefined"!=typeof Proxy?this.__myProxy=new Proxy(this,this._myHandler):this.__myProxy=z),!I(this.__myProxy)&&this.__myProxy}get do(){return this._doProxy?this._doProxy:{...this._actions,...this._doSetters}}get my(){return this._myProxy?this._myProxy:this.value}get value(){const t={};return this._virtuals.forEach((e,r)=>{t[r]=e.value}),this.streams.forEach((e,r)=>{t[r]=e.value}),t}values(...t){return it(t).reduce((t,e)=>(t[e]=this.streams.has(e)?this.streams.get(e).value:null,t),{})}get subject(){return this._subject}subscribe(...t){const e=this.subject.subscribe(...t);return this.subSets.add(e),e}get subjectValue(){return this._subjectValue||(this._subjectValue=this.subject.pipe(V(t=>Array.from(Object.keys(t)).reduce((e,r)=>(e[r]=t[r].value,e),{})))),this._subjectValue}subscribeValue(...t){const e=this.subjectValue.subscribe(...t);return this.subSets.add(e),e}complete(){this.stream.complete(),this.streams.forEach(t=>{t.complete()}),this._closeSets()}_makeProperty(t,e,...r){if(function(t,e="invalid property name"){if(!t||!Z(t)||$(t)){const r=new Error(e);throw r.name=t,r.absent=I(t),r}}(t),this.streams.has(t))throw new Error("cannot redefine "+t);const s=new ht(e,r);s.store=this,this.streams.set(t,s)}property(t,e,...r){return this._makeProperty(t,e,...r),this._initialized&&this._updateStream(),this}_updateStream(){this._relay&&this._relay.complete();const t=Array.from(this.streams.keys()),e=Array.from(this.streams.values()).map(t=>t.subject);this._relay=B(...e).pipe(V(e=>t.reduce((t,r,s)=>(t[r]=e[s],t),{}))).subscribe(t=>{this._subject.next(t)},t=>this._subject.error(t),()=>this._subject.complete()),this._initDo()}}e.proppify(yt).addProp("subSets",()=>new Set).addProp("_actions",()=>({})).addProp("streams",()=>new Map).addProp("_virtuals",()=>new Map);class _t{constructor(t){this.subjectBlock=t}done(){this.subjectBlock.blockDone(this)}}class mt{block(){const t=new _t(this);return this.blocks.add(t),this.update(),t}blockDone(t){this.blocks.delete(t),this.update()}update(){this.subject.next(this.blocks.size)}}return e.proppify(mt).addProp("subject",()=>new O(0).pipe(rt())).addProp("blocks",()=>new Set),{validators:W,SubjectMeta:ht,ValueStore:yt,ABSENT:z,MetaList:ct,Meta:ot,SubjectBlock:mt}}));
